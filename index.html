<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PLC Technical Assessment Simulator ‚Äì Automation Engineer Deployment Edition</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&family=Rajdhani:wght@400;600;700&display=swap');

  :root {
    --bg-primary: #050d1a;
    --bg-secondary: #081428;
    --bg-card: #0a1a2e;
    --bg-card2: #0d2040;
    --accent-orange: #ff6b00;
    --accent-orange2: #ff9500;
    --accent-blue: #00aaff;
    --accent-cyan: #00e5ff;
    --accent-green: #00ff88;
    --accent-red: #ff2244;
    --accent-yellow: #ffcc00;
    --text-primary: #e8f4ff;
    --text-secondary: #8ab4d4;
    --text-muted: #4a7a9b;
    --border-glow: rgba(0,170,255,0.3);
    --font-display: 'Orbitron', monospace;
    --font-mono: 'Share Tech Mono', monospace;
    --font-body: 'Rajdhani', sans-serif;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg-primary);
    color: var(--text-primary);
    font-family: var(--font-body);
    font-size: 16px;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* SCROLLBAR */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg-secondary); }
  ::-webkit-scrollbar-thumb { background: var(--accent-orange); border-radius: 3px; }

  /* BACKGROUND GRID */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,170,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,170,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  /* LAYOUT */
  .app-wrapper { display: flex; min-height: 100vh; position: relative; z-index: 1; }

  /* SIDEBAR */
  .sidebar {
    width: 260px;
    min-height: 100vh;
    background: linear-gradient(180deg, #060f1e 0%, #030810 100%);
    border-right: 1px solid rgba(0,170,255,0.2);
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0; left: 0;
    height: 100vh;
    overflow-y: auto;
    z-index: 100;
  }

  .sidebar-logo {
    padding: 24px 20px;
    border-bottom: 1px solid rgba(0,170,255,0.15);
  }

  .sidebar-logo .brand {
    font-family: var(--font-display);
    font-size: 11px;
    color: var(--accent-orange);
    letter-spacing: 2px;
    text-transform: uppercase;
    line-height: 1.6;
  }

  .sidebar-logo .brand-sub {
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-muted);
    margin-top: 4px;
    letter-spacing: 1px;
  }

  .sidebar-status {
    padding: 12px 20px;
    border-bottom: 1px solid rgba(0,170,255,0.1);
    display: flex;
    align-items: center;
    gap: 8px;
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--accent-green);
  }

  .status-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--accent-green);
    animation: pulse-green 2s infinite;
    flex-shrink: 0;
  }

  @keyframes pulse-green {
    0%, 100% { box-shadow: 0 0 4px var(--accent-green); opacity: 1; }
    50% { box-shadow: 0 0 12px var(--accent-green); opacity: 0.6; }
  }

  .sidebar-nav { flex: 1; padding: 16px 0; }

  .nav-section-label {
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-muted);
    letter-spacing: 3px;
    text-transform: uppercase;
    padding: 16px 20px 6px;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 11px 20px;
    cursor: pointer;
    font-family: var(--font-body);
    font-weight: 600;
    font-size: 13px;
    color: var(--text-secondary);
    transition: all 0.2s;
    border-left: 3px solid transparent;
    text-decoration: none;
  }

  .nav-item:hover, .nav-item.active {
    color: var(--text-primary);
    background: rgba(0,170,255,0.07);
    border-left-color: var(--accent-orange);
  }

  .nav-item .nav-icon {
    font-size: 16px;
    width: 20px;
    text-align: center;
  }

  .sidebar-footer {
    padding: 16px 20px;
    border-top: 1px solid rgba(0,170,255,0.1);
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-muted);
    line-height: 1.8;
  }

  /* MAIN CONTENT */
  .main-content {
    margin-left: 260px;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  /* TOP HEADER */
  .top-header {
    background: linear-gradient(90deg, #060f1e 0%, #0a1a2e 100%);
    border-bottom: 1px solid rgba(255,107,0,0.3);
    padding: 0 32px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky; top: 0; z-index: 50;
  }

  .header-title {
    font-family: var(--font-display);
    font-size: 13px;
    color: var(--accent-orange);
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .header-meta {
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .header-badge {
    background: rgba(255,107,0,0.15);
    border: 1px solid rgba(255,107,0,0.4);
    color: var(--accent-orange2);
    font-family: var(--font-mono);
    font-size: 10px;
    padding: 4px 10px;
    border-radius: 2px;
    letter-spacing: 1px;
  }

  .header-time {
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--text-muted);
  }

  /* CONTENT AREA */
  .content-area { padding: 32px; }

  /* SECTION HEADERS */
  .section-header {
    margin-bottom: 28px;
  }

  .section-tag {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--accent-orange);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 6px;
  }

  .section-title {
    font-family: var(--font-display);
    font-size: 22px;
    color: var(--text-primary);
    letter-spacing: 1px;
  }

  .section-divider {
    height: 2px;
    background: linear-gradient(90deg, var(--accent-orange), transparent);
    margin-top: 10px;
    border-radius: 1px;
  }

  /* CARDS */
  .card {
    background: var(--bg-card);
    border: 1px solid rgba(0,170,255,0.15);
    border-radius: 4px;
    padding: 24px;
    margin-bottom: 24px;
    position: relative;
    overflow: hidden;
  }

  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 3px; height: 100%;
    background: linear-gradient(180deg, var(--accent-orange), transparent);
  }

  .card-title {
    font-family: var(--font-display);
    font-size: 12px;
    color: var(--accent-blue);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .card-title::after {
    content: '';
    flex: 1;
    height: 1px;
    background: rgba(0,170,255,0.15);
  }

  /* SECTION PAGES */
  .page { display: none; }
  .page.active { display: block; }

  /* ==================== PLC SIMULATOR ==================== */
  .io-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 24px;
    margin-bottom: 24px;
  }

  .io-panel-title {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--accent-yellow);
    letter-spacing: 2px;
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255,204,0,0.2);
  }

  .io-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid rgba(0,170,255,0.07);
  }

  .io-label {
    font-family: var(--font-body);
    font-weight: 600;
    font-size: 14px;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .io-addr {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text-muted);
    background: rgba(0,170,255,0.05);
    padding: 2px 6px;
    border-radius: 2px;
  }

  /* TOGGLE SWITCH */
  .toggle-switch {
    position: relative;
    width: 52px; height: 26px;
  }

  .toggle-switch input { opacity: 0; width: 0; height: 0; }

  .toggle-slider {
    position: absolute;
    inset: 0;
    background: #1a2a3a;
    border: 1px solid rgba(0,170,255,0.2);
    border-radius: 13px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .toggle-slider::before {
    content: '';
    position: absolute;
    width: 18px; height: 18px;
    left: 3px; top: 3px;
    background: #4a7a9b;
    border-radius: 50%;
    transition: all 0.3s;
  }

  .toggle-switch input:checked + .toggle-slider {
    background: rgba(0,255,136,0.15);
    border-color: var(--accent-green);
    box-shadow: 0 0 12px rgba(0,255,136,0.3);
  }

  .toggle-switch input:checked + .toggle-slider::before {
    transform: translateX(26px);
    background: var(--accent-green);
  }

  /* Emergency stop special style */
  .estop-toggle .toggle-switch input:checked + .toggle-slider {
    background: rgba(255,34,68,0.15);
    border-color: var(--accent-red);
    box-shadow: 0 0 12px rgba(255,34,68,0.4);
  }
  .estop-toggle .toggle-switch input:checked + .toggle-slider::before {
    background: var(--accent-red);
  }

  /* LED OUTPUT */
  .led-output {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .led {
    width: 20px; height: 20px;
    border-radius: 50%;
    background: #1a2a3a;
    border: 2px solid #2a3a4a;
    transition: all 0.2s;
    position: relative;
    flex-shrink: 0;
  }

  .led.on-green {
    background: var(--accent-green);
    border-color: rgba(0,255,136,0.5);
    box-shadow: 0 0 10px var(--accent-green), 0 0 20px rgba(0,255,136,0.4);
    animation: led-pulse-green 1.5s infinite;
  }

  .led.on-red {
    background: var(--accent-red);
    border-color: rgba(255,34,68,0.5);
    box-shadow: 0 0 10px var(--accent-red), 0 0 20px rgba(255,34,68,0.4);
    animation: led-pulse-red 0.8s infinite;
  }

  .led.on-orange {
    background: var(--accent-orange);
    border-color: rgba(255,107,0,0.5);
    box-shadow: 0 0 10px var(--accent-orange), 0 0 20px rgba(255,107,0,0.4);
  }

  .led.on-blue {
    background: var(--accent-blue);
    border-color: rgba(0,170,255,0.5);
    box-shadow: 0 0 10px var(--accent-blue), 0 0 20px rgba(0,170,255,0.4);
  }

  @keyframes led-pulse-green {
    0%, 100% { box-shadow: 0 0 8px var(--accent-green), 0 0 16px rgba(0,255,136,0.3); }
    50% { box-shadow: 0 0 16px var(--accent-green), 0 0 32px rgba(0,255,136,0.5); }
  }

  @keyframes led-pulse-red {
    0%, 100% { box-shadow: 0 0 8px var(--accent-red), 0 0 16px rgba(255,34,68,0.4); }
    50% { box-shadow: 0 0 20px var(--accent-red), 0 0 40px rgba(255,34,68,0.6); }
  }

  .led-label {
    font-family: var(--font-body);
    font-weight: 600;
    font-size: 14px;
    color: var(--text-secondary);
  }

  .led-status {
    font-family: var(--font-mono);
    font-size: 10px;
    margin-left: auto;
    padding: 2px 8px;
    border-radius: 2px;
  }

  .led-status.on { color: var(--accent-green); background: rgba(0,255,136,0.1); }
  .led-status.off { color: var(--text-muted); background: rgba(0,0,0,0.2); }

  /* SCAN CYCLE VISUALIZER */
  .scan-cycle {
    display: flex;
    align-items: center;
    gap: 0;
    margin: 20px 0;
    overflow: hidden;
  }

  .scan-phase {
    flex: 1;
    padding: 12px 8px;
    text-align: center;
    border: 1px solid rgba(0,170,255,0.1);
    position: relative;
    transition: all 0.3s;
  }

  .scan-phase:not(:last-child)::after {
    content: '‚ñ∂';
    position: absolute;
    right: -10px;
    top: 50%; transform: translateY(-50%);
    color: var(--accent-orange);
    font-size: 12px;
    z-index: 2;
  }

  .scan-phase.active {
    background: rgba(255,107,0,0.12);
    border-color: var(--accent-orange);
    box-shadow: 0 0 20px rgba(255,107,0,0.2);
  }

  .scan-phase-label {
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--text-muted);
    letter-spacing: 2px;
    margin-bottom: 4px;
    text-transform: uppercase;
  }

  .scan-phase-name {
    font-family: var(--font-display);
    font-size: 10px;
    color: var(--text-secondary);
  }

  .scan-phase.active .scan-phase-name { color: var(--accent-orange); }

  .scan-time-display {
    text-align: center;
    margin-top: 12px;
    font-family: var(--font-mono);
    font-size: 13px;
    color: var(--accent-cyan);
  }

  /* LADDER LOGIC DISPLAY */
  .ladder-rung {
    display: flex;
    align-items: center;
    margin-bottom: 16px;
    position: relative;
  }

  .rung-rail {
    width: 100%;
    height: 2px;
    background: rgba(0,170,255,0.2);
    position: absolute;
    top: 50%;
    z-index: 0;
  }

  .ladder-container {
    width: 100%;
    font-family: var(--font-mono);
    font-size: 12px;
  }

  .rung {
    display: flex;
    align-items: center;
    gap: 0;
    margin: 8px 0;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(0,170,255,0.1);
    padding: 8px 12px;
    border-radius: 2px;
    flex-wrap: wrap;
  }

  .rung-num {
    color: var(--text-muted);
    font-size: 10px;
    width: 28px;
    flex-shrink: 0;
  }

  .rung-left-rail {
    color: var(--accent-blue);
    font-size: 14px;
    margin-right: 4px;
  }

  .contact {
    display: inline-flex;
    align-items: center;
    gap: 2px;
    padding: 2px 4px;
    border: 1px solid rgba(0,170,255,0.3);
    border-radius: 2px;
    color: var(--text-secondary);
    font-size: 11px;
    margin: 0 2px;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .contact.energized {
    border-color: var(--accent-green);
    color: var(--accent-green);
    background: rgba(0,255,136,0.07);
    box-shadow: 0 0 6px rgba(0,255,136,0.2);
  }

  .contact.nc { border-color: rgba(255,34,68,0.4); }
  .contact.nc.energized {
    border-color: var(--accent-red);
    color: var(--accent-red);
    background: rgba(255,34,68,0.07);
  }

  .coil {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    border: 2px solid rgba(0,170,255,0.4);
    border-radius: 12px;
    color: var(--text-secondary);
    font-size: 11px;
    margin-left: auto;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .coil.energized {
    border-color: var(--accent-orange);
    color: var(--accent-orange);
    background: rgba(255,107,0,0.1);
    box-shadow: 0 0 10px rgba(255,107,0,0.3);
  }

  .rung-wire {
    flex: 1;
    height: 2px;
    background: rgba(0,170,255,0.15);
    min-width: 10px;
    transition: background 0.2s;
  }

  .rung-wire.powered { background: var(--accent-green); box-shadow: 0 0 4px rgba(0,255,136,0.5); }

  /* FAULT INJECTION */
  .fault-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  .fault-btn {
    padding: 14px 16px;
    background: rgba(255,34,68,0.05);
    border: 1px solid rgba(255,34,68,0.2);
    border-radius: 3px;
    color: var(--text-secondary);
    font-family: var(--font-body);
    font-weight: 600;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .fault-btn:hover {
    background: rgba(255,34,68,0.12);
    border-color: var(--accent-red);
    color: var(--accent-red);
    box-shadow: 0 0 12px rgba(255,34,68,0.2);
  }

  .fault-btn.active {
    background: rgba(255,34,68,0.18);
    border-color: var(--accent-red);
    color: var(--accent-red);
    animation: fault-flash 1s infinite;
  }

  @keyframes fault-flash {
    0%, 100% { box-shadow: 0 0 8px rgba(255,34,68,0.3); }
    50% { box-shadow: 0 0 20px rgba(255,34,68,0.6); }
  }

  .fault-icon { font-size: 18px; }

  .fault-status-bar {
    margin-top: 16px;
    padding: 12px 16px;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(0,170,255,0.1);
    border-radius: 2px;
    font-family: var(--font-mono);
    font-size: 12px;
    color: var(--accent-cyan);
    min-height: 44px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .clear-faults-btn {
    margin-top: 12px;
    padding: 10px 20px;
    background: rgba(0,255,136,0.08);
    border: 1px solid rgba(0,255,136,0.3);
    border-radius: 3px;
    color: var(--accent-green);
    font-family: var(--font-mono);
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 1px;
  }

  .clear-faults-btn:hover {
    background: rgba(0,255,136,0.15);
    box-shadow: 0 0 10px rgba(0,255,136,0.2);
  }

  /* ==================== EXAM SECTION ==================== */
  .exam-timer-bar {
    background: var(--bg-card2);
    border: 1px solid rgba(0,170,255,0.2);
    border-radius: 3px;
    padding: 16px 24px;
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 20px;
  }

  .timer-label {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--text-muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    flex-shrink: 0;
  }

  .timer-progress-outer {
    flex: 1;
    height: 8px;
    background: rgba(0,0,0,0.4);
    border-radius: 4px;
    overflow: hidden;
  }

  .timer-progress-inner {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-green), var(--accent-orange));
    border-radius: 4px;
    transition: width 1s linear;
    width: 100%;
  }

  .timer-display {
    font-family: var(--font-display);
    font-size: 18px;
    color: var(--accent-orange);
    flex-shrink: 0;
    min-width: 70px;
    text-align: right;
  }

  .question-block {
    background: var(--bg-card);
    border: 1px solid rgba(0,170,255,0.12);
    border-radius: 4px;
    padding: 20px;
    margin-bottom: 16px;
    transition: border-color 0.2s;
  }

  .question-block.answered-correct { border-color: rgba(0,255,136,0.4); background: rgba(0,255,136,0.03); }
  .question-block.answered-wrong { border-color: rgba(255,34,68,0.4); background: rgba(255,34,68,0.03); }

  .question-num {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--accent-orange);
    letter-spacing: 2px;
    margin-bottom: 8px;
    text-transform: uppercase;
  }

  .question-text {
    font-family: var(--font-body);
    font-size: 15px;
    font-weight: 600;
    color: var(--text-primary);
    line-height: 1.5;
    margin-bottom: 14px;
  }

  .option-label {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    padding: 9px 12px;
    margin: 5px 0;
    border: 1px solid rgba(0,170,255,0.1);
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s;
    font-family: var(--font-body);
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.4;
  }

  .option-label:hover { background: rgba(0,170,255,0.06); border-color: rgba(0,170,255,0.25); color: var(--text-primary); }
  .option-label input { accent-color: var(--accent-orange); margin-top: 2px; flex-shrink: 0; }
  .option-label.correct-ans { background: rgba(0,255,136,0.08); border-color: var(--accent-green); color: var(--accent-green); }
  .option-label.wrong-ans { background: rgba(255,34,68,0.08); border-color: var(--accent-red); color: var(--accent-red); }

  .answer-feedback {
    display: none;
    margin-top: 10px;
    padding: 8px 12px;
    border-radius: 2px;
    font-family: var(--font-mono);
    font-size: 11px;
  }

  .answer-feedback.show { display: block; }
  .answer-feedback.correct { background: rgba(0,255,136,0.08); color: var(--accent-green); border-left: 3px solid var(--accent-green); }
  .answer-feedback.wrong { background: rgba(255,34,68,0.08); color: var(--accent-red); border-left: 3px solid var(--accent-red); }

  .scenario-block {
    background: var(--bg-card2);
    border: 1px solid rgba(255,204,0,0.2);
    border-radius: 4px;
    padding: 20px;
    margin-bottom: 16px;
  }

  .scenario-block::before {
    content: 'SCENARIO';
    display: block;
    font-family: var(--font-mono);
    font-size: 9px;
    color: var(--accent-yellow);
    letter-spacing: 3px;
    margin-bottom: 10px;
  }

  .scenario-desc {
    background: rgba(0,0,0,0.3);
    border-left: 3px solid var(--accent-yellow);
    padding: 12px 14px;
    margin-bottom: 14px;
    font-family: var(--font-body);
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.6;
    border-radius: 0 3px 3px 0;
  }

  .exam-actions {
    display: flex;
    gap: 14px;
    margin-top: 24px;
    flex-wrap: wrap;
  }

  .btn-primary {
    padding: 13px 28px;
    background: linear-gradient(135deg, var(--accent-orange), #cc5500);
    border: none;
    border-radius: 3px;
    color: white;
    font-family: var(--font-display);
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(255,107,0,0.4); }
  .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

  .btn-secondary {
    padding: 13px 28px;
    background: transparent;
    border: 1px solid rgba(0,170,255,0.4);
    border-radius: 3px;
    color: var(--accent-blue);
    font-family: var(--font-display);
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-secondary:hover { background: rgba(0,170,255,0.08); box-shadow: 0 0 15px rgba(0,170,255,0.2); }

  /* RESULTS DASHBOARD */
  .results-dashboard { display: none; }
  .results-dashboard.visible { display: block; }

  .score-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-bottom: 24px;
  }

  .score-card {
    background: var(--bg-card2);
    border: 1px solid rgba(0,170,255,0.15);
    border-radius: 4px;
    padding: 20px;
    text-align: center;
  }

  .score-card-label {
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text-muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 10px;
  }

  .score-card-value {
    font-family: var(--font-display);
    font-size: 36px;
    font-weight: 900;
    line-height: 1;
    margin-bottom: 4px;
  }

  .score-card-sub {
    font-family: var(--font-mono);
    font-size: 11px;
    color: var(--text-muted);
  }

  .grade-banner {
    padding: 20px 24px;
    border-radius: 4px;
    text-align: center;
    margin-bottom: 24px;
    border: 2px solid;
  }

  .grade-banner.deployment-ready { background: rgba(0,255,136,0.08); border-color: var(--accent-green); }
  .grade-banner.competent { background: rgba(0,170,255,0.08); border-color: var(--accent-blue); }
  .grade-banner.needs-improvement { background: rgba(255,204,0,0.08); border-color: var(--accent-yellow); }
  .grade-banner.not-ready { background: rgba(255,34,68,0.08); border-color: var(--accent-red); }

  .grade-title {
    font-family: var(--font-display);
    font-size: 20px;
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 6px;
  }

  .grade-sub {
    font-family: var(--font-body);
    font-size: 14px;
    color: var(--text-secondary);
  }

  /* CHART CANVAS */
  .chart-container {
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(0,170,255,0.1);
    border-radius: 4px;
    padding: 20px;
    margin-bottom: 24px;
  }

  /* CERTIFICATE */
  .certificate-area {
    border: 2px solid var(--accent-orange);
    border-radius: 4px;
    padding: 32px;
    text-align: center;
    background: linear-gradient(135deg, rgba(255,107,0,0.05), rgba(0,170,255,0.05));
    position: relative;
    overflow: hidden;
  }

  .certificate-area::before, .certificate-area::after {
    content: '';
    position: absolute;
    width: 60px; height: 60px;
    border: 2px solid rgba(255,107,0,0.3);
  }

  .certificate-area::before { top: 10px; left: 10px; border-right: none; border-bottom: none; }
  .certificate-area::after { bottom: 10px; right: 10px; border-left: none; border-top: none; }

  .cert-title {
    font-family: var(--font-display);
    font-size: 14px;
    color: var(--accent-orange);
    letter-spacing: 4px;
    text-transform: uppercase;
    margin-bottom: 16px;
  }

  .cert-name {
    font-family: var(--font-display);
    font-size: 24px;
    color: var(--text-primary);
    margin-bottom: 8px;
  }

  .cert-body {
    font-family: var(--font-body);
    font-size: 15px;
    color: var(--text-secondary);
    line-height: 1.7;
    margin-bottom: 20px;
  }

  .cert-score-display {
    font-family: var(--font-display);
    font-size: 48px;
    font-weight: 900;
    color: var(--accent-orange);
    margin-bottom: 4px;
  }

  /* SCROLL TO TOP */
  .scroll-top-btn {
    position: fixed;
    bottom: 30px; right: 30px;
    width: 44px; height: 44px;
    background: var(--accent-orange);
    border: none;
    border-radius: 2px;
    color: white;
    font-size: 18px;
    cursor: pointer;
    z-index: 999;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(255,107,0,0.4);
    transition: all 0.2s;
  }

  .scroll-top-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(255,107,0,0.5); }

  /* HERO PANEL */
  .hero-panel {
    background: linear-gradient(135deg, #060f1e, #0a1a2e);
    border: 1px solid rgba(255,107,0,0.2);
    border-radius: 4px;
    padding: 40px;
    margin-bottom: 28px;
    position: relative;
    overflow: hidden;
    text-align: center;
  }

  .hero-panel::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse at 50% 0%, rgba(255,107,0,0.08) 0%, transparent 70%);
  }

  .hero-panel-title {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: 900;
    color: var(--text-primary);
    letter-spacing: 3px;
    margin-bottom: 10px;
    position: relative;
  }

  .hero-panel-title span { color: var(--accent-orange); }

  .hero-panel-sub {
    font-family: var(--font-body);
    font-size: 16px;
    color: var(--text-secondary);
    margin-bottom: 24px;
    position: relative;
  }

  .hero-stats {
    display: flex;
    justify-content: center;
    gap: 40px;
    position: relative;
  }

  .hero-stat { text-align: center; }
  .hero-stat-num { font-family: var(--font-display); font-size: 28px; color: var(--accent-orange); }
  .hero-stat-label { font-family: var(--font-mono); font-size: 9px; color: var(--text-muted); letter-spacing: 2px; margin-top: 2px; }

  /* COLLAPSIBLE */
  .collapsible-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    padding: 14px 0;
    border-bottom: 1px solid rgba(0,170,255,0.1);
    margin-bottom: 16px;
    user-select: none;
  }

  .collapsible-header:hover { color: var(--text-primary); }

  .collapsible-toggle {
    font-size: 16px;
    color: var(--accent-orange);
    transition: transform 0.3s;
  }

  .collapsible-toggle.open { transform: rotate(180deg); }
  .collapsible-content { display: block; }
  .collapsible-content.closed { display: none; }

  /* ==================== WORKBOOK SCREEN STYLES ==================== */
  .wb-field-label {
    display: block;
    font-family: var(--font-mono);
    font-size: 10px;
    color: var(--text-muted);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 6px;
  }

  .wb-input {
    width: 100%;
    padding: 10px 14px;
    background: rgba(0,0,0,0.35);
    border: 1px solid rgba(0,170,255,0.2);
    border-radius: 3px;
    color: var(--text-primary);
    font-family: var(--font-body);
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  .wb-input:focus { border-color: var(--accent-orange); box-shadow: 0 0 8px rgba(255,107,0,0.15); }

  .wb-page {
    background: #f5f5f5;
    color: #1a1a1a;
    border: 1px solid rgba(0,170,255,0.15);
    border-radius: 4px;
    margin-bottom: 28px;
    padding: 48px 52px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.4);
    position: relative;
    font-family: 'Georgia', 'Times New Roman', serif;
  }

  .wb-cover-inner {
    text-align: center;
    padding: 60px 40px;
    border: 3px double #1a3a5c;
    min-height: 600px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
  }

  .wb-org-line { font-family: Arial,sans-serif; font-size: 11px; letter-spacing: 4px; text-transform: uppercase; color: #555; margin-bottom: 20px; }
  .wb-cover-title { font-family: Georgia,serif; font-size: 34px; font-weight: bold; color: #0d2040; letter-spacing: 3px; line-height: 1.2; }
  .wb-cover-subtitle { font-family: Arial,sans-serif; font-size: 15px; letter-spacing: 4px; color: #555; text-transform: uppercase; margin-bottom: 8px; }
  .wb-cover-bar { width: 80px; height: 4px; background: #d45000; margin: 16px auto; }
  .wb-cover-facility { font-family: Georgia,serif; font-size: 18px; color: #1a3a5c; font-style: italic; margin-bottom: 4px; }
  .wb-cover-standard { font-family: Arial,sans-serif; font-size: 10px; letter-spacing: 2px; color: #777; text-transform: uppercase; margin-bottom: 32px; }

  .wb-cover-meta-grid { width: 100%; max-width: 460px; background: #fff; border: 1px solid #ccc; border-radius: 3px; padding: 20px 24px; text-align: left; margin: 0 auto 24px; }
  .wb-cover-meta-row { display: flex; gap: 12px; padding: 7px 0; border-bottom: 1px dotted #ddd; font-family: Arial,sans-serif; font-size: 13px; }
  .wb-cover-meta-row:last-child { border-bottom: none; }
  .wb-cover-meta-label { color: #555; font-weight: bold; min-width: 130px; font-size: 11px; letter-spacing: 1px; text-transform: uppercase; padding-top: 2px; }
  .wb-cover-meta-val { color: #0d2040; font-weight: bold; font-size: 14px; }
  .wb-cover-footer-line { font-family: Arial,sans-serif; font-size: 9px; letter-spacing: 3px; text-transform: uppercase; color: #999; margin-top: 20px; }

  .wb-section-header { border-bottom: 3px solid #0d2040; padding-bottom: 14px; margin-bottom: 20px; }
  .wb-section-tag { font-family: Arial,sans-serif; font-size: 10px; letter-spacing: 4px; text-transform: uppercase; color: #d45000; margin-bottom: 4px; }
  .wb-section-title { font-family: Georgia,serif; font-size: 20px; color: #0d2040; font-weight: bold; }
  .wb-section-meta { font-family: Arial,sans-serif; font-size: 11px; color: #666; margin-top: 4px; }

  .wb-instruction { background: #fff8ee; border-left: 4px solid #d45000; padding: 10px 14px; margin-bottom: 20px; font-family: Arial,sans-serif; font-size: 12px; color: #444; line-height: 1.6; border-radius: 0 3px 3px 0; }

  .wb-mc-q { margin-bottom: 20px; padding-bottom: 18px; border-bottom: 1px dotted #ccc; page-break-inside: avoid; }
  .wb-mc-q-num { font-family: Arial,sans-serif; font-size: 11px; font-weight: bold; color: #0d2040; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
  .wb-mc-q-text { font-family: Georgia,serif; font-size: 14px; color: #1a1a1a; line-height: 1.55; margin-bottom: 10px; }
  .wb-mc-opts { display: grid; grid-template-columns: 1fr 1fr; gap: 6px 20px; }
  .wb-mc-opt { font-family: Arial,sans-serif; font-size: 13px; color: #333; display: flex; gap: 8px; align-items: flex-start; line-height: 1.4; }
  .wb-mc-opt-letter { font-weight: bold; color: #0d2040; flex-shrink: 0; min-width: 18px; }
  .wb-mc-bubble { width: 14px; height: 14px; border: 1.5px solid #333; border-radius: 50%; flex-shrink: 0; margin-top: 1px; }

  .wb-answer-key { display: none; margin-top: 28px; padding: 18px 20px; background: #fffbf0; border: 2px solid #d45000; border-radius: 3px; page-break-inside: avoid; }
  .wb-answer-key.visible { display: block; }
  .wb-ak-title { font-family: Arial,sans-serif; font-size: 11px; letter-spacing: 3px; text-transform: uppercase; color: #d45000; font-weight: bold; margin-bottom: 12px; border-bottom: 1px solid #f0d0a0; padding-bottom: 8px; }
  #wb-mc-ak-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 6px 10px; }
  .wb-ak-item { font-family: Arial,sans-serif; font-size: 12px; color: #333; padding: 4px 8px; background: #fff; border: 1px solid #e0c090; border-radius: 2px; display: flex; gap: 6px; }
  .wb-ak-qn { font-weight: bold; color: #0d2040; min-width: 24px; }
  .wb-ak-ans { color: #d45000; font-weight: bold; }
  .wb-ak-exp { font-size: 11px; color: #444; line-height: 1.6; margin-top: 4px; }

  .wb-scenario-q { margin-bottom: 24px; page-break-inside: avoid; border: 1px solid #ccc; border-radius: 3px; padding: 14px; background: #fff; }
  .wb-sc-label { font-family: Arial,sans-serif; font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: #d45000; margin-bottom: 4px; }
  .wb-sc-title { font-family: Georgia,serif; font-size: 15px; color: #0d2040; font-weight: bold; margin-bottom: 8px; }
  .wb-sc-desc { font-family: Arial,sans-serif; font-size: 12px; color: #333; line-height: 1.7; background: #f0f6ff; border-left: 4px solid #1a3a5c; padding: 10px 14px; margin-bottom: 10px; border-radius: 0 3px 3px 0; }
  .wb-sc-question { font-family: Georgia,serif; font-size: 13px; color: #1a1a1a; font-weight: bold; margin-bottom: 8px; font-style: italic; }
  .wb-sc-opt { font-family: Arial,sans-serif; font-size: 12px; color: #333; display: flex; gap: 8px; padding: 4px 0; align-items: flex-start; line-height: 1.4; }
  .wb-justify-label { font-family: Arial,sans-serif; font-size: 11px; font-weight: bold; color: #555; margin-bottom: 4px; letter-spacing: 1px; margin-top: 8px; }

  .wb-ladder-prompt { display: flex; gap: 16px; margin-bottom: 28px; page-break-inside: avoid; border: 1px solid #ccc; border-radius: 3px; padding: 16px; background: #fff; }
  .wb-lp-num { font-family: Arial,sans-serif; font-size: 14px; font-weight: bold; color: #0d2040; background: #e8f0f8; border: 2px solid #1a3a5c; border-radius: 3px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .wb-lp-body { flex: 1; }
  .wb-lp-title { font-family: Georgia,serif; font-size: 14px; font-weight: bold; color: #0d2040; margin-bottom: 6px; }
  .wb-lp-desc { font-family: Arial,sans-serif; font-size: 12px; color: #444; line-height: 1.6; margin-bottom: 12px; }
  .wb-grid-inner { display: flex; align-items: center; gap: 4px; background: #f0f6ff; border: 1px solid #b0c8e0; border-radius: 2px; padding: 8px; margin-bottom: 8px; font-family: 'Courier New',monospace; font-size: 11px; color: #555; overflow-x: auto; }
  .wb-grid-rail { font-size: 18px; color: #1a3a5c; font-weight: bold; }
  .wb-grid-cells { flex: 1; }
  .wb-grid-row { padding: 2px 0; }
  .wb-drawing-area { background: #fafafa; border: 1px dashed #aaa; border-radius: 2px; min-height: 80px; padding: 8px; position: relative; }
  .wb-drawing-label { font-family: Arial,sans-serif; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: #bbb; margin-bottom: 6px; }
  .wb-dot-grid { background-image: radial-gradient(circle, #ccc 1px, transparent 1px); background-size: 20px 20px; min-height: 60px; width: 100%; }
  .wb-score-row { display: flex; justify-content: space-between; font-family: Arial,sans-serif; font-size: 11px; color: #555; border-top: 1px dotted #ccc; padding-top: 6px; margin-top: 8px; }
  .wb-section-score-total { display: flex; justify-content: space-between; font-family: Arial,sans-serif; font-size: 13px; font-weight: bold; color: #0d2040; border-top: 2px solid #0d2040; padding-top: 10px; margin-top: 8px; }

  .wb-short-answer { display: flex; gap: 16px; margin-bottom: 24px; page-break-inside: avoid; border: 1px solid #ccc; border-radius: 3px; padding: 16px; background: #fff; }
  .wb-sa-num { font-family: Arial,sans-serif; font-size: 13px; font-weight: bold; color: #0d2040; background: #fff8ee; border: 2px solid #d45000; border-radius: 3px; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .wb-sa-body { flex: 1; }
  .wb-sa-q { font-family: Georgia,serif; font-size: 13px; color: #1a1a1a; line-height: 1.6; margin-bottom: 12px; }
  .wb-answer-lines { margin-bottom: 10px; }
  .wb-line { border-bottom: 1px solid #bbb; height: 24px; margin-bottom: 4px; width: 100%; }
  .wb-sa-key { font-family: Arial,sans-serif; font-size: 11px; color: #444; line-height: 1.7; }
  .wb-ak-inline-title { font-weight: bold; color: #d45000; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 6px; }

  .wb-score-table-wrap { margin-bottom: 24px; overflow-x: auto; }
  .wb-score-table { width: 100%; border-collapse: collapse; font-family: Arial,sans-serif; font-size: 13px; }
  .wb-score-table th { background: #0d2040; color: #fff; padding: 10px 12px; text-align: left; font-size: 11px; letter-spacing: 1px; text-transform: uppercase; }
  .wb-score-table td { padding: 10px 12px; border-bottom: 1px solid #ddd; color: #333; }
  .wb-score-table tr:nth-child(even) td { background: #f5f8fc; }
  .wb-total-row td { background: #e8f0f8 !important; border-top: 2px solid #0d2040; color: #0d2040; font-size: 14px; }

  .wb-rating-section { margin-bottom: 24px; }
  .wb-rating-title { font-family: Arial,sans-serif; font-size: 11px; letter-spacing: 3px; text-transform: uppercase; color: #0d2040; font-weight: bold; margin-bottom: 12px; }
  .wb-rating-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; }
  .wb-rating-cell { border: 2px solid #ccc; border-radius: 3px; padding: 14px 10px; text-align: center; background: #fff; }
  .wb-rating-range { font-family: Arial,sans-serif; font-size: 13px; font-weight: bold; color: #0d2040; margin-bottom: 4px; }
  .wb-rating-label { font-family: Arial,sans-serif; font-size: 10px; letter-spacing: 1px; text-transform: uppercase; color: #555; margin-bottom: 8px; line-height: 1.4; }
  .wb-rating-check { font-size: 18px; color: #333; }
  .wb-rating-cell.selected { border-color: #d45000; background: #fff8ee; }

  .wb-comments-section { margin-bottom: 28px; }
  .wb-comments-title { font-family: Arial,sans-serif; font-size: 11px; letter-spacing: 2px; text-transform: uppercase; color: #555; font-weight: bold; margin-bottom: 10px; }

  .wb-sig-section { display: grid; grid-template-columns: repeat(3,1fr); gap: 24px; margin-bottom: 24px; margin-top: 28px; }
  .wb-sig-block { text-align: center; }
  .wb-sig-line { border-bottom: 2px solid #333; height: 40px; margin-bottom: 6px; }
  .wb-sig-label { font-family: Arial,sans-serif; font-size: 12px; font-weight: bold; color: #333; margin-bottom: 3px; }
  .wb-sig-sublabel { font-family: Arial,sans-serif; font-size: 10px; color: #777; }

  .wb-footer-stamp { text-align: center; font-family: Arial,sans-serif; font-size: 9px; letter-spacing: 2px; text-transform: uppercase; color: #999; border-top: 1px solid #ddd; padding-top: 12px; margin-top: 20px; }

  /* ==================== PRINT CSS ==================== */
  @media print {
    .sidebar,
    .top-header,
    .scroll-top-btn,
    .section-header,
    #wb-candidate-card,
    #wb-preview-notice,
    .exam-actions,
    .fault-grid,
    .scan-cycle,
    .btn-primary,
    .btn-secondary,
    .clear-faults-btn,
    #pdf-instructions { display: none !important; }

    body { background: #fff !important; color: #000 !important; font-size: 12pt; margin: 0; padding: 0; }
    body::before { display: none !important; }
    .app-wrapper { display: block !important; }
    .main-content { margin-left: 0 !important; }
    .content-area { padding: 0 !important; }

    .page { display: none !important; }
    #page-workbook { display: block !important; padding: 0 !important; }
    #wb-content { display: block !important; }
    #wb-preview-notice { display: none !important; }

    .wb-page {
      background: #fff !important;
      color: #000 !important;
      border: none !important;
      box-shadow: none !important;
      border-radius: 0 !important;
      margin: 0 !important;
      padding: 15mm 18mm 15mm 18mm !important;
    }

    @page { size: A4; margin: 10mm 12mm; }

    .wb-page-break { page-break-before: always; }
    .wb-mc-q, .wb-scenario-q, .wb-short-answer, .wb-ladder-prompt { page-break-inside: avoid !important; }

    .wb-cover-title { font-size: 26pt !important; }
    .wb-section-title { font-size: 15pt !important; }
    .wb-mc-q-text { font-size: 11pt !important; }
    .wb-sa-q { font-size: 11pt !important; }

    .wb-score-table { border-collapse: collapse !important; }
    .wb-score-table th, .wb-score-table td { border: 1px solid #333 !important; padding: 5pt 8pt !important; }
    .wb-score-table th { background: #1a3a5c !important; color: #fff !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .wb-total-row td { background: #e8f0f8 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }

    .wb-cover-inner { border: 3pt double #1a3a5c !important; }
    .wb-instruction { background: #fff8ee !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .wb-sc-desc { background: #f0f6ff !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .wb-answer-key { background: #fffbf0 !important; border: 2pt solid #d45000 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .wb-grid-inner { background: #f0f6ff !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .wb-answer-key.visible { display: block !important; }
    .wb-answer-key:not(.visible) { display: none !important; }
    .wb-rating-cell.selected { background: #fff8ee !important; border-color: #d45000 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .wb-dot-grid { background-image: radial-gradient(circle, #aaa 1px, transparent 1px) !important; background-size: 18pt 18pt !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .wb-cover-bar { background: #d45000 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  }

  /* MISC */
  .info-row {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px solid rgba(0,170,255,0.07);
    font-family: var(--font-body);
    font-size: 14px;
  }

  .info-row-label { color: var(--text-muted); }
  .info-row-value { color: var(--text-primary); font-weight: 600; font-family: var(--font-mono); font-size: 12px; }

  .section-separator { height: 48px; }

  @media (max-width: 900px) {
    .sidebar { width: 200px; }
    .main-content { margin-left: 200px; }
    .io-grid { grid-template-columns: 1fr; }
    .score-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<div class="app-wrapper">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="brand">PLC ASSESSMENT<br>SIMULATOR</div>
    <div class="brand-sub">DEPLOYMENT EDITION v2.4.1</div>
  </div>
  <div class="sidebar-status">
    <div class="status-dot"></div>
    SYSTEM ONLINE ‚Äì SERBIA ICE CREAM PLANT
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section-label">Navigation</div>
    <a class="nav-item active" onclick="showPage('dashboard')">
      <span class="nav-icon">‚ö°</span> Dashboard
    </a>
    <div class="nav-section-label">PLC Simulator</div>
    <a class="nav-item" onclick="showPage('io-panel')">
      <span class="nav-icon">üîò</span> Digital I/O Panel
    </a>
    <a class="nav-item" onclick="showPage('ladder')">
      <span class="nav-icon">üìä</span> Ladder Logic
    </a>
    <a class="nav-item" onclick="showPage('scan')">
      <span class="nav-icon">üîÑ</span> Scan Cycle
    </a>
    <a class="nav-item" onclick="showPage('faults')">
      <span class="nav-icon">‚ö†Ô∏è</span> Fault Injection
    </a>
    <div class="nav-section-label">Assessment</div>
    <a class="nav-item" onclick="showPage('exam-mc')">
      <span class="nav-icon">üìù</span> Technical Exam
    </a>
    <a class="nav-item" onclick="showPage('exam-scenario')">
      <span class="nav-icon">üîß</span> Scenario Cases
    </a>
    <a class="nav-item" onclick="showPage('results')">
      <span class="nav-icon">üèÜ</span> Results & Report
    </a>
    <a class="nav-item" onclick="showPage('workbook')">
      <span class="nav-icon">üìò</span> Printable Workbook
    </a>
  </nav>
  <div class="sidebar-footer">
    FACILITY: Serbia ICE CREAM PLANT<br>
    UNIT: AUTOMATION TRAINING<br>
    STANDARD: IEC 61131-3<br>
    SAFETY: ISO 13849 / IEC 62061
  </div>
</aside>

<!-- MAIN CONTENT -->
<main class="main-content">

  <!-- TOP HEADER -->
  <header class="top-header">
    <div class="header-title">PLC Technical Assessment Simulator</div>
    <div class="header-meta">
      <div class="header-badge">DEPLOYMENT EDITION</div>
      <div class="header-badge" style="border-color:rgba(0,255,136,0.4);color:var(--accent-green);">SERBIA</div>
      <div class="header-time" id="live-clock">--:--:--</div>
    </div>
  </header>

  <div class="content-area">

    <!-- ============ DASHBOARD PAGE ============ -->
    <div class="page active" id="page-dashboard">
      <div class="hero-panel">
        <div class="hero-panel-title">Automation Engineer <span>Deployment Readiness</span> System</div>
        <div class="hero-panel-sub">Serbia Ice Cream Production Facility ‚Äì PLC Technical Training & Assessment Platform</div>
        <div class="hero-stats">
          <div class="hero-stat"><div class="hero-stat-num">25</div><div class="hero-stat-label">Total Questions</div></div>
          <div class="hero-stat"><div class="hero-stat-num">6</div><div class="hero-stat-label">PLC Modules</div></div>
          <div class="hero-stat"><div class="hero-stat-num">45</div><div class="hero-stat-label">Min Exam Time</div></div>
          <div class="hero-stat"><div class="hero-stat-num">75%</div><div class="hero-stat-label">Pass Threshold</div></div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;">
        <div class="card">
          <div class="card-title">System Information</div>
          <div class="info-row"><span class="info-row-label">Platform</span><span class="info-row-value">PLC-SIM Pro</span></div>
          <div class="info-row"><span class="info-row-label">PLC Standard</span><span class="info-row-value">IEC 61131-3</span></div>
          <div class="info-row"><span class="info-row-label">Facility</span><span class="info-row-value">Serbia ICE CREAM</span></div>
          <div class="info-row"><span class="info-row-label">Network</span><span class="info-row-value">PROFINET / EtherNet/IP</span></div>
          <div class="info-row"><span class="info-row-label">Safety</span><span class="info-row-value">ISO 13849 CAT 3 PLd</span></div>
          <div class="info-row"><span class="info-row-label">Scan Cycle</span><span class="info-row-value">10 ms typical</span></div>
        </div>
        <div class="card">
          <div class="card-title">Assessment Modules</div>
          <div class="info-row"><span class="info-row-label">PLC Ladder Logic</span><span class="info-row-value">ACTIVE</span></div>
          <div class="info-row"><span class="info-row-label">Timer / Counter</span><span class="info-row-value">ACTIVE</span></div>
          <div class="info-row"><span class="info-row-label">PID Fundamentals</span><span class="info-row-value">ACTIVE</span></div>
          <div class="info-row"><span class="info-row-label">Food Safety Automation</span><span class="info-row-value">ACTIVE</span></div>
          <div class="info-row"><span class="info-row-label">PROFINET Basics</span><span class="info-row-value">ACTIVE</span></div>
          <div class="info-row"><span class="info-row-label">Fault Diagnosis</span><span class="info-row-value">ACTIVE</span></div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Quick Start</div>
        <div style="display:flex;gap:12px;flex-wrap:wrap;">
          <button class="btn-primary" onclick="showPage('io-panel')">‚ñ∂ Launch PLC Simulator</button>
          <button class="btn-primary" onclick="startExam()">üìù Begin Assessment</button>
          <button class="btn-secondary" onclick="showPage('results')">üèÜ View Results</button>
        </div>
      </div>
    </div>

    <!-- ============ I/O PANEL PAGE ============ -->
    <div class="page" id="page-io-panel">
      <div class="section-header">
        <div class="section-tag">Module 01 // PLC Simulator</div>
        <div class="section-title">Digital I/O Control Panel</div>
        <div class="section-divider"></div>
      </div>

      <div class="io-grid">
        <!-- INPUTS -->
        <div class="card">
          <div class="card-title">Digital Inputs</div>
          <div class="io-panel-title">‚ñº INPUT SIGNALS ‚Äî I:0.0</div>

          <div class="io-item">
            <div class="io-label"><span class="io-addr">I0.0</span> Start Button</div>
            <label class="toggle-switch">
              <input type="checkbox" id="sw-start" onchange="updatePLC()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="io-item">
            <div class="io-label"><span class="io-addr">I0.1</span> Stop Button</div>
            <label class="toggle-switch">
              <input type="checkbox" id="sw-stop" onchange="updatePLC()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="io-item estop-toggle">
            <div class="io-label"><span class="io-addr">I0.2</span> Emergency Stop</div>
            <label class="toggle-switch">
              <input type="checkbox" id="sw-estop" onchange="updatePLC()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="io-item">
            <div class="io-label"><span class="io-addr">I0.3</span> Overload Fault</div>
            <label class="toggle-switch">
              <input type="checkbox" id="sw-overload" onchange="updatePLC()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="io-item">
            <div class="io-label"><span class="io-addr">I0.4</span> Freezer Temp OK</div>
            <label class="toggle-switch">
              <input type="checkbox" id="sw-freezer" checked onchange="updatePLC()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="io-item">
            <div class="io-label"><span class="io-addr">I0.5</span> Conveyor Sensor</div>
            <label class="toggle-switch">
              <input type="checkbox" id="sw-conveyor" onchange="updatePLC()">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- OUTPUTS -->
        <div class="card">
          <div class="card-title">Digital Outputs</div>
          <div class="io-panel-title">‚ñº OUTPUT SIGNALS ‚Äî Q:0.0</div>

          <div class="io-item">
            <div class="led-output">
              <div class="led" id="led-motor"></div>
              <div class="led-label"><span class="io-addr" style="margin-right:6px">Q0.0</span> Motor Run</div>
              <div class="led-status off" id="led-motor-status">OFF</div>
            </div>
          </div>
          <div class="io-item">
            <div class="led-output">
              <div class="led" id="led-alarm"></div>
              <div class="led-label"><span class="io-addr" style="margin-right:6px">Q0.1</span> Alarm</div>
              <div class="led-status off" id="led-alarm-status">OFF</div>
            </div>
          </div>
          <div class="io-item">
            <div class="led-output">
              <div class="led" id="led-compressor"></div>
              <div class="led-label"><span class="io-addr" style="margin-right:6px">Q0.2</span> Compressor</div>
              <div class="led-status off" id="led-compressor-status">OFF</div>
            </div>
          </div>
          <div class="io-item">
            <div class="led-output">
              <div class="led" id="led-convmotor"></div>
              <div class="led-label"><span class="io-addr" style="margin-right:6px">Q0.3</span> Conveyor Motor</div>
              <div class="led-status off" id="led-convmotor-status">OFF</div>
            </div>
          </div>

          <div style="margin-top:20px;padding:14px;background:rgba(0,0,0,0.3);border:1px solid rgba(0,170,255,0.1);border-radius:3px;">
            <div style="font-family:var(--font-mono);font-size:10px;color:var(--text-muted);letter-spacing:2px;margin-bottom:8px;">SYSTEM STATUS LOG</div>
            <div id="plc-status-log" style="font-family:var(--font-mono);font-size:11px;color:var(--accent-cyan);line-height:1.8;min-height:60px;">
              System initialized. Awaiting inputs...
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title">PLC Logic Description</div>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;">
          <div style="padding:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(0,170,255,0.1);border-radius:3px;">
            <div style="font-family:var(--font-mono);font-size:9px;color:var(--accent-orange);letter-spacing:2px;margin-bottom:6px;">RUNG 1</div>
            <div style="font-size:12px;color:var(--text-secondary);">Motor Start/Stop with Seal-In latch. Motor runs when Start pressed and latches via auxiliary contact.</div>
          </div>
          <div style="padding:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(0,170,255,0.1);border-radius:3px;">
            <div style="font-family:var(--font-mono);font-size:9px;color:var(--accent-orange);letter-spacing:2px;margin-bottom:6px;">RUNG 2</div>
            <div style="font-size:12px;color:var(--text-secondary);">Overload & E-Stop interlock. Either condition cuts all outputs immediately via NC contacts.</div>
          </div>
          <div style="padding:12px;background:rgba(0,0,0,0.3);border:1px solid rgba(0,170,255,0.1);border-radius:3px;">
            <div style="font-family:var(--font-mono);font-size:9px;color:var(--accent-orange);letter-spacing:2px;margin-bottom:6px;">RUNG 3</div>
            <div style="font-size:12px;color:var(--text-secondary);">Freezer compressor requires Temp OK signal. Conveyor motor follows conveyor sensor input.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- ============ LADDER LOGIC PAGE ============ -->
    <div class="page" id="page-ladder">
      <div class="section-header">
        <div class="section-tag">Module 02 // Ladder Logic</div>
        <div class="section-title">Ladder Logic Simulation</div>
        <div class="section-divider"></div>
      </div>

      <div class="card">
        <div class="card-title">Live Ladder Diagram ‚Äî Serbia Ice Cream Production</div>
        <div class="ladder-container" id="ladder-diagram">
          <!-- Rungs rendered by JS -->
        </div>
        <div style="margin-top:16px;font-family:var(--font-mono);font-size:10px;color:var(--text-muted);display:flex;gap:20px;flex-wrap:wrap;">
          <span>[ ] = NO Contact</span>
          <span>[/] = NC Contact</span>
          <span>( ) = Output Coil</span>
          <span style="color:var(--accent-green);">GREEN = Energized</span>
          <span style="color:var(--accent-red);">RED = NC Opened</span>
        </div>
      </div>

      <div class="card">
        <div class="card-title">I/O Quick Toggle</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
          <span style="font-family:var(--font-mono);font-size:11px;color:var(--text-muted);">TOGGLE:</span>
          <button class="btn-secondary" style="padding:8px 14px;font-size:10px;" onclick="toggleFromLadder('sw-start')">START</button>
          <button class="btn-secondary" style="padding:8px 14px;font-size:10px;" onclick="toggleFromLadder('sw-stop')">STOP</button>
          <button class="btn-secondary" style="padding:8px 14px;font-size:10px;border-color:rgba(255,34,68,0.4);color:var(--accent-red);" onclick="toggleFromLadder('sw-estop')">E-STOP</button>
          <button class="btn-secondary" style="padding:8px 14px;font-size:10px;" onclick="toggleFromLadder('sw-overload')">OVERLOAD</button>
          <button class="btn-secondary" style="padding:8px 14px;font-size:10px;" onclick="toggleFromLadder('sw-freezer')">FREEZER OK</button>
          <button class="btn-secondary" style="padding:8px 14px;font-size:10px;" onclick="toggleFromLadder('sw-conveyor')">CONVEYOR SEN.</button>
        </div>
      </div>
    </div>

    <!-- ============ SCAN CYCLE PAGE ============ -->
    <div class="page" id="page-scan">
      <div class="section-header">
        <div class="section-tag">Module 03 // Scan Cycle</div>
        <div class="section-title">PLC Scan Cycle Visualizer</div>
        <div class="section-divider"></div>
      </div>

      <div class="card">
        <div class="card-title">Scan Cycle Animation</div>
        <div class="scan-cycle">
          <div class="scan-phase" id="scan-input">
            <div class="scan-phase-label">Phase 1</div>
            <div class="scan-phase-name">INPUT SCAN</div>
          </div>
          <div class="scan-phase" id="scan-logic">
            <div class="scan-phase-label">Phase 2</div>
            <div class="scan-phase-name">LOGIC EXEC</div>
          </div>
          <div class="scan-phase" id="scan-output">
            <div class="scan-phase-label">Phase 3</div>
            <div class="scan-phase-name">OUTPUT UPDATE</div>
          </div>
          <div class="scan-phase" id="scan-comm">
            <div class="scan-phase-label">Phase 4</div>
            <div class="scan-phase-name">COMMS</div>
          </div>
          <div class="scan-phase" id="scan-diag">
            <div class="scan-phase-label">Phase 5</div>
            <div class="scan-phase-name">DIAGNOSTICS</div>
          </div>
        </div>
        <div class="scan-time-display">
          Cycle Time: <span id="scan-time-val">--</span> ms &nbsp;|&nbsp; Scans/sec: <span id="scan-rate">--</span>
        </div>
        <div style="text-align:center;margin-top:16px;display:flex;gap:12px;justify-content:center;">
          <button class="btn-primary" id="scan-run-btn" onclick="startScanCycle()">‚ñ∂ START SCAN</button>
          <button class="btn-secondary" onclick="stopScanCycle()">‚èπ STOP</button>
        </div>
      </div>

      <div class="card">
        <div class="card-title">Scan Cycle Details</div>
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;">
          <div>
            <div class="info-row"><span class="info-row-label">Input Scan Duration</span><span class="info-row-value" id="sc-input-time">~1.2 ms</span></div>
            <div class="info-row"><span class="info-row-label">Logic Execution</span><span class="info-row-value" id="sc-logic-time">~6.8 ms</span></div>
            <div class="info-row"><span class="info-row-label">Output Update</span><span class="info-row-value" id="sc-output-time">~0.8 ms</span></div>
          </div>
          <div>
            <div class="info-row"><span class="info-row-label">Communications</span><span class="info-row-value" id="sc-comm-time">~0.9 ms</span></div>
            <div class="info-row"><span class="info-row-label">Self-Diagnostics</span><span class="info-row-value" id="sc-diag-time">~0.3 ms</span></div>
            <div class="info-row"><span class="info-row-label">Total Cycle</span><span class="info-row-value" id="sc-total-time">~10.0 ms</span></div>
          </div>
        </div>
        <div style="margin-top:16px;padding:14px;background:rgba(255,107,0,0.05);border:1px solid rgba(255,107,0,0.15);border-radius:3px;font-size:13px;color:var(--text-secondary);">
          <strong style="color:var(--accent-orange);">Note:</strong> PLC scan cycle is deterministic and cyclical. The watchdog timer monitors for scan overruns (typically 150ms limit). In food manufacturing, consistent scan times are critical for precise timing of filling, sealing, and freezing operations.
        </div>
      </div>
    </div>

    <!-- ============ FAULT INJECTION PAGE ============ -->
    <div class="page" id="page-faults">
      <div class="section-header">
        <div class="section-tag">Module 04 // Fault Injection</div>
        <div class="section-title">Fault Injection Mode</div>
        <div class="section-divider"></div>
      </div>

      <div class="card">
        <div class="card-title">Inject System Faults</div>
        <div class="fault-grid">
          <button class="fault-btn" id="fault-sensor" onclick="injectFault('sensor')">
            <span class="fault-icon">üì°</span>
            <div><div style="font-weight:700;">Sensor Failure</div><div style="font-size:11px;color:var(--text-muted);margin-top:2px;">I0.5 Conveyor Sensor Lost</div></div>
          </button>
          <button class="fault-btn" id="fault-cpu" onclick="injectFault('cpu')">
            <span class="fault-icon">üñ•Ô∏è</span>
            <div><div style="font-weight:700;">PLC CPU Fault</div><div style="font-size:11px;color:var(--text-muted);margin-top:2px;">Watchdog Timeout Triggered</div></div>
          </button>
          <button class="fault-btn" id="fault-comm" onclick="injectFault('comm')">
            <span class="fault-icon">üåê</span>
            <div><div style="font-weight:700;">Communication Loss</div><div style="font-size:11px;color:var(--text-muted);margin-top:2px;">PROFINET Link Down</div></div>
          </button>
          <button class="fault-btn" id="fault-temp" onclick="injectFault('temp')">
            <span class="fault-icon">üå°Ô∏è</span>
            <div><div style="font-weight:700;">Analog Temp Deviation</div><div style="font-size:11px;color:var(--text-muted);margin-top:2px;">Freezer High Temp Alarm</div></div>
          </button>
        </div>
        <div class="fault-status-bar" id="fault-status-bar">
          <span style="color:var(--accent-green);">‚óè</span> No active faults. System nominal.
        </div>
        <button class="clear-faults-btn" onclick="clearAllFaults()">‚úì CLEAR ALL FAULTS</button>
      </div>

      <div class="card">
        <div class="card-title">Active Fault Log</div>
        <div id="fault-log" style="font-family:var(--font-mono);font-size:11px;color:var(--text-secondary);line-height:2;min-height:80px;">
          <span style="color:var(--text-muted);">No faults recorded.</span>
        </div>
      </div>
    </div>

    <!-- ============ EXAM MC PAGE ============ -->
    <div class="page" id="page-exam-mc">
      <div class="section-header">
        <div class="section-tag">Assessment // Technical Exam</div>
        <div class="section-title">Multiple Choice Technical Assessment</div>
        <div class="section-divider"></div>
      </div>

      <div class="exam-timer-bar">
        <div class="timer-label">TIME REMAINING</div>
        <div class="timer-progress-outer">
          <div class="timer-progress-inner" id="mc-timer-bar"></div>
        </div>
        <div class="timer-display" id="mc-timer-display">45:00</div>
      </div>

      <div id="mc-questions-container"></div>

      <div class="exam-actions">
        <button class="btn-primary" id="submit-mc-btn" onclick="submitMCExam()">Submit Answers</button>
        <button class="btn-secondary" onclick="resetMCExam()">Reset Exam</button>
      </div>
    </div>

    <!-- ============ EXAM SCENARIO PAGE ============ -->
    <div class="page" id="page-exam-scenario">
      <div class="section-header">
        <div class="section-tag">Assessment // Scenario Cases</div>
        <div class="section-title">Practical Troubleshooting Scenarios</div>
        <div class="section-divider"></div>
      </div>

      <div id="scenario-questions-container"></div>

      <div class="exam-actions">
        <button class="btn-primary" id="submit-scenario-btn" onclick="submitScenarioExam()">Submit Scenarios</button>
        <button class="btn-secondary" onclick="resetScenarioExam()">Reset</button>
      </div>
    </div>

    <!-- ============ RESULTS PAGE ============ -->
    <div class="page" id="page-results">
      <div class="section-header">
        <div class="section-tag">Assessment // Final Report</div>
        <div class="section-title">Performance Results Dashboard</div>
        <div class="section-divider"></div>
      </div>

      <div id="results-placeholder" class="card">
        <div style="text-align:center;padding:32px;">
          <div style="font-size:48px;margin-bottom:16px;">üìä</div>
          <div style="font-family:var(--font-display);font-size:16px;color:var(--text-muted);letter-spacing:2px;">Complete the assessment to view results</div>
          <div style="margin-top:20px;display:flex;gap:12px;justify-content:center;">
            <button class="btn-primary" onclick="showPage('exam-mc')">Begin Technical Exam</button>
            <button class="btn-secondary" onclick="showPage('exam-scenario')">Begin Scenarios</button>
          </div>
        </div>
      </div>

      <div class="results-dashboard" id="results-dashboard">
        <div id="grade-banner-container"></div>

        <div class="score-grid">
          <div class="score-card">
            <div class="score-card-label">Total Score</div>
            <div class="score-card-value" id="res-total" style="color:var(--accent-orange);">--</div>
            <div class="score-card-sub">/ 100 Points</div>
          </div>
          <div class="score-card">
            <div class="score-card-label">Technical Score</div>
            <div class="score-card-value" id="res-technical" style="color:var(--accent-blue);">--</div>
            <div class="score-card-sub">/ 20 Questions</div>
          </div>
          <div class="score-card">
            <div class="score-card-label">Troubleshooting</div>
            <div class="score-card-value" id="res-scenario" style="color:var(--accent-green);">--</div>
            <div class="score-card-sub">/ 5 Scenarios</div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Performance Chart</div>
          <div class="chart-container">
            <canvas id="perf-chart" width="600" height="200"></canvas>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Deployment Certificate</div>
          <div class="certificate-area" id="certificate-area">
            <div class="cert-title">Certificate of Technical Assessment</div>
            <div style="font-family:var(--font-mono);font-size:11px;color:var(--text-muted);margin-bottom:16px;">PLC TECHNICAL ASSESSMENT SIMULATOR ‚Äì DEPLOYMENT EDITION</div>
            <div class="cert-name">AUTOMATION ENGINEER</div>
            <div class="cert-body">
              Has successfully completed the PLC Technical Assessment for<br>
              <strong style="color:var(--accent-orange);">Serbia Ice Cream Production Facility</strong><br>
              Demonstrating technical proficiency in industrial automation systems,<br>
              PLC programming, and food manufacturing safety protocols.
            </div>
            <div class="cert-score-display" id="cert-score">--</div>
            <div style="font-family:var(--font-mono);font-size:11px;color:var(--text-muted);margin-bottom:20px;">OVERALL SCORE</div>
            <div id="cert-grade" style="font-family:var(--font-display);font-size:14px;letter-spacing:3px;color:var(--accent-orange);margin-bottom:8px;"></div>
            <div style="font-family:var(--font-mono);font-size:10px;color:var(--text-muted);" id="cert-date"></div>
          </div>
          <div style="margin-top:16px;display:flex;gap:12px;flex-wrap:wrap;">
            <button class="btn-primary" onclick="window.print()">üñ®Ô∏è Print Certificate</button>
            <button class="btn-secondary" onclick="resetAllExams()">üîÑ Reset All</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ============ WORKBOOK PAGE ============ -->
    <div class="page" id="page-workbook">
      <div class="section-header">
        <div class="section-tag">Documentation // Printable Workbook</div>
        <div class="section-title">PLC Technical Assessment ‚Äì Printable Workbook Edition</div>
        <div class="section-divider"></div>
      </div>

      <!-- CANDIDATE INFO CARD -->
      <div class="card" id="wb-candidate-card">
        <div class="card-title">Candidate Information</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
          <div>
            <label class="wb-field-label">Full Name</label>
            <input class="wb-input" type="text" id="wb-name" placeholder="Enter full name">
          </div>
          <div>
            <label class="wb-field-label">Date of Assessment</label>
            <input class="wb-input" type="date" id="wb-date">
          </div>
          <div>
            <label class="wb-field-label">Position Applied For</label>
            <input class="wb-input" type="text" id="wb-position" placeholder="e.g. Senior PLC Automation Engineer">
          </div>
          <div>
            <label class="wb-field-label">Deployment Location</label>
            <input class="wb-input" type="text" id="wb-location" placeholder="e.g. Serbia ‚Äì Ice Cream Production Plant">
          </div>
          <div>
            <label class="wb-field-label">Assessor Name</label>
            <input class="wb-input" type="text" id="wb-assessor" placeholder="Enter assessor name">
          </div>
          <div>
            <label class="wb-field-label">Overall Score (auto-filled)</label>
            <input class="wb-input" type="text" id="wb-score" placeholder="Complete exam to auto-fill" readonly style="opacity:0.7;">
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:20px;margin-top:20px;flex-wrap:wrap;">
          <label style="display:flex;align-items:center;gap:10px;cursor:pointer;font-family:var(--font-body);font-weight:600;font-size:14px;color:var(--text-secondary);">
            <input type="checkbox" id="wb-include-answers" style="accent-color:var(--accent-orange);width:16px;height:16px;">
            Include Answer Key in Workbook
          </label>
          <div style="font-family:var(--font-mono);font-size:10px;color:var(--text-muted);">‚òë Reveals correct answers at end of each section when printing</div>
        </div>
        <div style="margin-top:20px;display:flex;gap:12px;flex-wrap:wrap;">
          <button class="btn-primary" onclick="generateWorkbook()">üìò Generate Workbook</button>
          <button class="btn-primary" onclick="printWorkbook()" style="background:linear-gradient(135deg,#005580,#003355);">üñ®Ô∏è Print Workbook</button>
          <button class="btn-secondary" onclick="showPDFInstructions()">üìÑ Save as PDF</button>
        </div>
        <div id="pdf-instructions" style="display:none;margin-top:14px;padding:12px 16px;background:rgba(0,170,255,0.07);border:1px solid rgba(0,170,255,0.2);border-radius:3px;font-family:var(--font-mono);font-size:11px;color:var(--accent-cyan);line-height:1.9;">
          TO SAVE AS PDF:<br>
          1. Click "Print Workbook"<br>
          2. In the print dialog, set Destination to "Save as PDF"<br>
          3. Set Paper Size to A4, Margins to Default<br>
          4. Enable "Background graphics" if color is needed<br>
          5. Click Save ‚Äî a professionally formatted PDF will be generated.
        </div>
      </div>

      <!-- WORKBOOK PREVIEW NOTICE -->
      <div id="wb-preview-notice" class="card" style="text-align:center;padding:40px;">
        <div style="font-size:48px;margin-bottom:16px;">üìã</div>
        <div style="font-family:var(--font-display);font-size:15px;color:var(--text-muted);letter-spacing:2px;">Fill in candidate information above and click Generate Workbook</div>
      </div>

      <!-- WORKBOOK CONTENT (shown after generate) -->
      <div id="wb-content" style="display:none;">

        <!-- COVER PAGE -->
        <div class="wb-page" id="wb-cover">
          <div class="wb-cover-inner">
            <div class="wb-org-line">INDUSTRIAL AUTOMATION TRAINING DIVISION</div>
            <div class="wb-cover-title">PLC TECHNICAL ASSESSMENT</div>
            <div class="wb-cover-subtitle">DEPLOYMENT READINESS EVALUATION</div>
            <div class="wb-cover-bar"></div>
            <div class="wb-cover-facility">Serbia Ice Cream Production Facility</div>
            <div class="wb-cover-standard">IEC 61131-3 ¬∑ ISO 13849 ¬∑ PROFINET ¬∑ Food Safety Automation</div>
            <div class="wb-cover-meta-grid">
              <div class="wb-cover-meta-row"><span class="wb-cover-meta-label">CANDIDATE:</span><span class="wb-cover-meta-val" id="wb-print-name">‚Äî</span></div>
              <div class="wb-cover-meta-row"><span class="wb-cover-meta-label">POSITION:</span><span class="wb-cover-meta-val" id="wb-print-position">‚Äî</span></div>
              <div class="wb-cover-meta-row"><span class="wb-cover-meta-label">DEPLOYMENT:</span><span class="wb-cover-meta-val" id="wb-print-location">‚Äî</span></div>
              <div class="wb-cover-meta-row"><span class="wb-cover-meta-label">ASSESSOR:</span><span class="wb-cover-meta-val" id="wb-print-assessor">‚Äî</span></div>
              <div class="wb-cover-meta-row"><span class="wb-cover-meta-label">DATE:</span><span class="wb-cover-meta-val" id="wb-print-date">‚Äî</span></div>
              <div class="wb-cover-meta-row"><span class="wb-cover-meta-label">ASSESSMENT ID:</span><span class="wb-cover-meta-val" id="wb-print-id">‚Äî</span></div>
            </div>
            <div class="wb-cover-footer-line">CONFIDENTIAL ‚Äî FOR AUTHORIZED ASSESSMENT USE ONLY</div>
          </div>
        </div>

        <!-- SECTION A: MULTIPLE CHOICE -->
        <div class="wb-page wb-page-break" id="wb-section-a">
          <div class="wb-section-header">
            <div class="wb-section-tag">SECTION A</div>
            <div class="wb-section-title">Multiple Choice ‚Äì PLC Technical Knowledge</div>
            <div class="wb-section-meta">20 Questions ¬∑ 4 Points Each ¬∑ Total: 80 Points ¬∑ Time Allowed: 40 Minutes</div>
          </div>
          <div class="wb-instruction">Instructions: Circle or select the ONE best answer for each question. Each question carries equal marks. No negative marking.</div>
          <div id="wb-mc-questions"></div>
          <div class="wb-answer-key" id="wb-mc-answer-key">
            <div class="wb-ak-title">SECTION A ‚Äì ANSWER KEY</div>
            <div id="wb-mc-ak-grid"></div>
          </div>
        </div>

        <!-- SECTION B: SCENARIOS -->
        <div class="wb-page wb-page-break" id="wb-section-b">
          <div class="wb-section-header">
            <div class="wb-section-tag">SECTION B</div>
            <div class="wb-section-title">Practical Troubleshooting Scenarios</div>
            <div class="wb-section-meta">5 Cases ¬∑ 4 Points Each ¬∑ Total: 20 Points ¬∑ Time Allowed: 20 Minutes</div>
          </div>
          <div class="wb-instruction">Instructions: Read each scenario carefully. Select the most appropriate corrective action from the options provided. Justify your answer in the space provided.</div>
          <div id="wb-scenario-questions"></div>
          <div class="wb-answer-key" id="wb-scenario-answer-key">
            <div class="wb-ak-title">SECTION B ‚Äì ANSWER KEY & EXPLANATIONS</div>
            <div id="wb-scenario-ak-grid"></div>
          </div>
        </div>

        <!-- SECTION C: LADDER LOGIC DRAWING -->
        <div class="wb-page wb-page-break" id="wb-section-c">
          <div class="wb-section-header">
            <div class="wb-section-tag">SECTION C</div>
            <div class="wb-section-title">Ladder Logic Drawing Exercise</div>
            <div class="wb-section-meta">Practical Drawing Assessment ¬∑ Assessor Evaluated</div>
          </div>
          <div class="wb-instruction">Instructions: Using the grid areas provided, draw the ladder logic rungs for each control requirement. Label all contacts (NO/NC), coils, addresses, and add a brief description of each rung's function.</div>

          <div class="wb-ladder-prompt">
            <div class="wb-lp-num">C-1</div>
            <div class="wb-lp-body">
              <div class="wb-lp-title">Motor Start/Stop with Seal-In Circuit</div>
              <div class="wb-lp-desc">Draw a ladder rung that starts a motor (Q0.0) using a momentary Start button (I0.0) with a seal-in auxiliary contact. Include a Stop button (I0.1) as a Normally Closed contact to de-energize the motor coil.</div>
              <div class="wb-grid-area">
                <div class="wb-grid-inner">
                  <div class="wb-grid-rail wb-grid-rail-left">|</div>
                  <div class="wb-grid-cells">
                    <div class="wb-grid-row" style="border-bottom:1px dashed #ccc;padding-bottom:6px;margin-bottom:4px;color:#999;font-size:10px;letter-spacing:1px;">[ START I0.0 ] ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ [ SEAL Q0.0 ] ‚îÄ‚îÄ[/ STOP I0.1 ]‚îÄ‚îÄ‚îÄ‚îÄ ( MOTOR Q0.0 )</div>
                    <div class="wb-grid-row">&nbsp;</div>
                    <div class="wb-grid-row">&nbsp;</div>
                    <div class="wb-grid-row">&nbsp;</div>
                    <div class="wb-grid-row">&nbsp;</div>
                  </div>
                  <div class="wb-grid-rail wb-grid-rail-right">|</div>
                </div>
                <div class="wb-drawing-area">
                  <div class="wb-drawing-label">CANDIDATE DRAWING AREA</div>
                  <div class="wb-dot-grid"></div>
                </div>
              </div>
              <div class="wb-score-row"><span>Marks Available: 5</span><span>Marks Awarded: ______</span></div>
            </div>
          </div>

          <div class="wb-ladder-prompt">
            <div class="wb-lp-num">C-2</div>
            <div class="wb-lp-body">
              <div class="wb-lp-title">Emergency Stop Master Cut-Out</div>
              <div class="wb-lp-desc">Draw the E-Stop interlock rung that uses a Normally Closed E-Stop contact (I0.2) in series with an Overload relay NC contact (I0.3). When either opens, the safety output bit (M0.0 SAFETY OK) de-energizes, cutting all downstream motor outputs.</div>
              <div class="wb-drawing-area">
                <div class="wb-drawing-label">CANDIDATE DRAWING AREA</div>
                <div class="wb-dot-grid"></div>
              </div>
              <div class="wb-score-row"><span>Marks Available: 5</span><span>Marks Awarded: ______</span></div>
            </div>
          </div>

          <div class="wb-ladder-prompt">
            <div class="wb-lp-num">C-3</div>
            <div class="wb-lp-body">
              <div class="wb-lp-title">Freezer Compressor Interlock with Alarm</div>
              <div class="wb-lp-desc">Draw two rungs: (1) Compressor (Q0.2) enabled only when Freezer Temp OK (I0.4) is TRUE and Safety OK (M0.0) is TRUE. (2) Alarm output (Q0.1) energized when Freezer Temp OK is FALSE or any fault bit is set.</div>
              <div class="wb-drawing-area" style="height:120px;">
                <div class="wb-drawing-label">CANDIDATE DRAWING AREA</div>
                <div class="wb-dot-grid"></div>
              </div>
              <div class="wb-score-row"><span>Marks Available: 10</span><span>Marks Awarded: ______</span></div>
            </div>
          </div>

          <div class="wb-section-score-total">
            <span>Section C Total Marks Available: 20</span>
            <span>Section C Total Marks Awarded: __________</span>
          </div>
        </div>

        <!-- SECTION D: SHORT ANSWER -->
        <div class="wb-page wb-page-break" id="wb-section-d">
          <div class="wb-section-header">
            <div class="wb-section-tag">SECTION D</div>
            <div class="wb-section-title">Short Answer ‚Äì Technical Knowledge</div>
            <div class="wb-section-meta">4 Questions ¬∑ 5 Points Each ¬∑ Total: 20 Points</div>
          </div>
          <div class="wb-instruction">Instructions: Answer each question in clear, concise technical language. Reference applicable standards where appropriate. Use the lines provided.</div>

          <div class="wb-short-answer">
            <div class="wb-sa-num">D-1</div>
            <div class="wb-sa-body">
              <div class="wb-sa-q">Explain the PLC scan cycle. Name and briefly describe each phase, and explain why scan cycle time is critical in food manufacturing automation applications such as ice cream production filling systems.</div>
              <div class="wb-answer-lines"><div class="wb-line" id="wb-d1-ak-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div></div>
              <div class="wb-answer-key wb-sa-key" id="wb-sa-d1-key">
                <div class="wb-ak-inline-title">Model Answer:</div>
                The PLC scan cycle consists of 5 phases executed continuously: (1) Input Scan ‚Äî reads all physical input states into the input image table; (2) Logic Execution ‚Äî processes all program rungs using the image table; (3) Output Update ‚Äî writes computed results to physical outputs; (4) Communications ‚Äî handles HMI, SCADA, and network data exchange; (5) Diagnostics ‚Äî runs self-checks and watchdog reset. Typical cycle time: 5‚Äì20 ms. In ice cream filling, scan time determines control precision for dosing valves, fill timing, and conveyor indexing ‚Äî excessive scan time causes product overfill or underfill defects.
              </div>
              <div class="wb-score-row"><span>Marks Available: 5</span><span>Marks Awarded: ______</span></div>
            </div>
          </div>

          <div class="wb-short-answer">
            <div class="wb-sa-num">D-2</div>
            <div class="wb-sa-body">
              <div class="wb-sa-q">Define electrical interlocking in PLC control systems. Explain with a practical example how hardware and software interlocks are used together in a food production conveyor system to prevent mechanical damage and ensure operator safety.</div>
              <div class="wb-answer-lines"><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div></div>
              <div class="wb-answer-key wb-sa-key" id="wb-sa-d2-key">
                <div class="wb-ak-inline-title">Model Answer:</div>
                Interlocking prevents two or more conflicting states from occurring simultaneously. Hardware interlocks use physical contacts (e.g., NC auxiliary contacts of one contactor wired into the coil circuit of another) to prevent simultaneous energization. Software interlocks in PLC ladder logic use NC contacts of one output coil in series with another rung. Example: In a conveyor system, the downstream conveyor must start before the upstream conveyor. A NC contact of Q0.3 (upstream motor) is placed in the rung controlling Q0.4 (downstream), ensuring correct sequencing. Combined hardware + software interlocks provide redundant protection per ISO 13849 requirements.
              </div>
              <div class="wb-score-row"><span>Marks Available: 5</span><span>Marks Awarded: ______</span></div>
            </div>
          </div>

          <div class="wb-short-answer">
            <div class="wb-sa-num">D-3</div>
            <div class="wb-sa-body">
              <div class="wb-sa-q">Describe PID control. Explain the role of each term (Proportional, Integral, Derivative), identify a real process variable in ice cream production where PID control is applied, and describe what happens if the Integral gain is set too high.</div>
              <div class="wb-answer-lines"><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div></div>
              <div class="wb-answer-key wb-sa-key" id="wb-sa-d3-key">
                <div class="wb-ak-inline-title">Model Answer:</div>
                PID (Proportional-Integral-Derivative) is a closed-loop control algorithm. P: Output proportional to current error ‚Äî provides immediate corrective response but may leave steady-state error. I: Integrates error over time ‚Äî eliminates steady-state offset but can cause windup and overshoot. D: Acts on rate of change of error ‚Äî reduces overshoot and improves stability but amplifies noise. In ice cream production, PID controls freezer barrel temperature to maintain product consistency at -5¬∞C to -7¬∞C during continuous freezing. If Integral gain is too high: integral windup occurs ‚Äî the controller overreacts, causing sustained oscillation around setpoint (hunting), product temperature instability, and potential freezer compressor cycling damage.
              </div>
              <div class="wb-score-row"><span>Marks Available: 5</span><span>Marks Awarded: ______</span></div>
            </div>
          </div>

          <div class="wb-short-answer">
            <div class="wb-sa-num">D-4</div>
            <div class="wb-sa-body">
              <div class="wb-sa-q">Explain the role of automation in food safety compliance. Describe how a PLC-based system in an ice cream production facility supports HACCP requirements, maintains traceability, and responds to a Critical Control Point (CCP) deviation such as a pasteurization temperature failure.</div>
              <div class="wb-answer-lines"><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div></div>
              <div class="wb-answer-key wb-sa-key" id="wb-sa-d4-key">
                <div class="wb-ak-inline-title">Model Answer:</div>
                HACCP (Hazard Analysis and Critical Control Points) requires identifying hazards and establishing critical control points with measurable limits. PLCs support HACCP by: (1) Continuously monitoring CCP parameters (pasteurization temperature ‚â•72¬∞C for 15 seconds) via analog inputs; (2) Triggering automatic corrective actions ‚Äî if temperature drops below CCP limit, PLC activates divert valve to redirect product to reject line, halts filling, and logs event with timestamp to SCADA historian; (3) Maintaining batch traceability through lot numbers linked to PLC data records; (4) Generating automated reports for regulatory compliance (FDA 21 CFR Part 11, EU food law); (5) Preventing product release by interlocking packaging equipment until CCP confirmation is received. This eliminates human error at critical safety checkpoints.
              </div>
              <div class="wb-score-row"><span>Marks Available: 5</span><span>Marks Awarded: ______</span></div>
            </div>
          </div>
        </div>

        <!-- SCORING SUMMARY PAGE -->
        <div class="wb-page wb-page-break" id="wb-section-score">
          <div class="wb-section-header">
            <div class="wb-section-tag">EVALUATION SUMMARY</div>
            <div class="wb-section-title">Technical Assessment ‚Äì Final Score Sheet</div>
            <div class="wb-section-meta">Assessor Use Only ¬∑ Confidential</div>
          </div>

          <div class="wb-score-table-wrap">
            <table class="wb-score-table">
              <thead>
                <tr>
                  <th>Section</th>
                  <th>Description</th>
                  <th>Max Marks</th>
                  <th>Marks Awarded</th>
                  <th>Percentage</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>A</strong></td>
                  <td>Multiple Choice ‚Äì PLC Technical Knowledge</td>
                  <td>80</td>
                  <td id="wb-final-mc">______</td>
                  <td>______%</td>
                </tr>
                <tr>
                  <td><strong>B</strong></td>
                  <td>Practical Troubleshooting Scenarios</td>
                  <td>20</td>
                  <td id="wb-final-sc">______</td>
                  <td>______%</td>
                </tr>
                <tr>
                  <td><strong>C</strong></td>
                  <td>Ladder Logic Drawing Exercise</td>
                  <td>20</td>
                  <td>______</td>
                  <td>______%</td>
                </tr>
                <tr>
                  <td><strong>D</strong></td>
                  <td>Short Answer ‚Äì Technical Knowledge</td>
                  <td>20</td>
                  <td>______</td>
                  <td>______%</td>
                </tr>
                <tr class="wb-total-row">
                  <td colspan="2"><strong>TOTAL SCORE</strong></td>
                  <td><strong>140</strong></td>
                  <td id="wb-final-total"><strong>______</strong></td>
                  <td id="wb-final-pct"><strong>______%</strong></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="wb-rating-section">
            <div class="wb-rating-title">DEPLOYMENT READINESS RATING</div>
            <div class="wb-rating-grid">
              <div class="wb-rating-cell" id="wb-rate-dr">
                <div class="wb-rating-range">90 ‚Äì 100%</div>
                <div class="wb-rating-label">DEPLOYMENT READY</div>
                <div class="wb-rating-check">‚òê</div>
              </div>
              <div class="wb-rating-cell" id="wb-rate-tc">
                <div class="wb-rating-range">75 ‚Äì 89%</div>
                <div class="wb-rating-label">TECHNICALLY COMPETENT</div>
                <div class="wb-rating-check">‚òê</div>
              </div>
              <div class="wb-rating-cell" id="wb-rate-ni">
                <div class="wb-rating-range">60 ‚Äì 74%</div>
                <div class="wb-rating-label">NEEDS IMPROVEMENT</div>
                <div class="wb-rating-check">‚òê</div>
              </div>
              <div class="wb-rating-cell" id="wb-rate-nr">
                <div class="wb-rating-range">Below 60%</div>
                <div class="wb-rating-label">NOT READY</div>
                <div class="wb-rating-check">‚òê</div>
              </div>
            </div>
          </div>

          <div class="wb-comments-section">
            <div class="wb-comments-title">Assessor Comments</div>
            <div class="wb-comments-lines">
              <div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div>
            </div>
          </div>

          <div class="wb-sig-section">
            <div class="wb-sig-block">
              <div class="wb-sig-line"></div>
              <div class="wb-sig-label">Candidate Signature</div>
              <div class="wb-sig-sublabel">Print Name: <span id="wb-sig-name">____________________________</span></div>
            </div>
            <div class="wb-sig-block">
              <div class="wb-sig-line"></div>
              <div class="wb-sig-label">Assessor Signature</div>
              <div class="wb-sig-sublabel">Print Name: <span id="wb-sig-assessor">____________________________</span></div>
            </div>
            <div class="wb-sig-block">
              <div class="wb-sig-line"></div>
              <div class="wb-sig-label">Date of Assessment</div>
              <div class="wb-sig-sublabel">Assessment ID: <span id="wb-sig-id">____________________________</span></div>
            </div>
          </div>

          <div class="wb-footer-stamp">
            PLC Technical Assessment Simulator ‚Äì Deployment Edition &nbsp;|&nbsp; IEC 61131-3 Reference &nbsp;|&nbsp; CONFIDENTIAL
          </div>
        </div>

      </div><!-- end wb-content -->
    </div><!-- end page-workbook -->

  </div><!-- end content-area -->
</main>
</div>

<!-- SCROLL TO TOP -->
<button class="scroll-top-btn" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚ñ≤</button>

<script>
// ============================================================
// NAVIGATION
// ============================================================
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const pg = document.getElementById('page-' + id);
  if (pg) pg.classList.add('active');
  // Match nav
  document.querySelectorAll('.nav-item').forEach(n => {
    if (n.getAttribute('onclick') && n.getAttribute('onclick').includes(id)) n.classList.add('active');
  });
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Live clock
function updateClock() {
  const now = new Date();
  document.getElementById('live-clock').textContent =
    now.toLocaleTimeString('en-GB', { hour12: false });
}
setInterval(updateClock, 1000); updateClock();

// ============================================================
// PLC LOGIC ENGINE
// ============================================================
let motorSealIn = false;
let faultStates = { sensor: false, cpu: false, comm: false, temp: false };
let faultLog = [];

function getInput(id) {
  const el = document.getElementById(id);
  return el ? el.checked : false;
}

function setLED(id, colorClass, statusText) {
  const led = document.getElementById('led-' + id);
  const stat = document.getElementById('led-' + id + '-status');
  if (!led) return;
  led.className = 'led' + (colorClass ? ' ' + colorClass : '');
  if (stat) {
    stat.textContent = statusText;
    stat.className = 'led-status ' + (colorClass ? 'on' : 'off');
  }
}

function updatePLC() {
  const start = getInput('sw-start');
  const stop = getInput('sw-stop');
  const estop = getInput('sw-estop');
  const overload = getInput('sw-overload');
  const freezerOK = getInput('sw-freezer');
  const convSensor = getInput('sw-conveyor');

  // E-Stop or overload kills everything
  const safetyOK = !estop && !overload && !faultStates.cpu && !faultStates.sensor;

  // Motor seal-in logic
  if (start && safetyOK && !stop) motorSealIn = true;
  if (stop || !safetyOK) motorSealIn = false;

  const motorRun = motorSealIn && safetyOK;
  const alarm = estop || overload || faultStates.cpu || faultStates.sensor || faultStates.temp;
  const compressor = freezerOK && safetyOK && !faultStates.temp;
  const convMotor = convSensor && safetyOK;

  setLED('motor', motorRun ? 'on-green' : '', motorRun ? 'ON' : 'OFF');
  setLED('alarm', alarm ? 'on-red' : '', alarm ? 'ALARM' : 'OFF');
  setLED('compressor', compressor ? 'on-blue' : '', compressor ? 'ON' : 'OFF');
  setLED('convmotor', convMotor ? 'on-orange' : '', convMotor ? 'ON' : 'OFF');

  // Status log
  let msgs = [];
  if (motorRun) msgs.push('[Q0.0] Motor RUNNING');
  if (alarm) msgs.push('[Q0.1] ALARM ACTIVE');
  if (estop) msgs.push('[SAFETY] E-STOP ENGAGED');
  if (overload) msgs.push('[FAULT] OVERLOAD DETECTED');
  if (compressor) msgs.push('[Q0.2] Compressor RUNNING');
  if (convMotor) msgs.push('[Q0.3] Conveyor Motor RUNNING');
  if (!motorRun && !alarm) msgs.push('System idle - awaiting start command');

  const logEl = document.getElementById('plc-status-log');
  if (logEl) logEl.innerHTML = msgs.join('<br>') || 'System nominal.';

  updateLadderDiagram(start, stop, estop, overload, freezerOK, convSensor, motorRun, alarm, compressor, convMotor);
}

function toggleFromLadder(id) {
  const el = document.getElementById(id);
  if (el) { el.checked = !el.checked; updatePLC(); }
}

// ============================================================
// LADDER DIAGRAM
// ============================================================
function updateLadderDiagram(start, stop, estop, overload, freezerOK, convSensor, motorRun, alarm, compressor, convMotor) {
  const container = document.getElementById('ladder-diagram');
  if (!container) return;

  const safetyOK = !estop && !overload;

  const rungs = [
    {
      num: 1, desc: 'Motor Start/Stop with Seal-In',
      contacts: [
        { label: 'I0.0\nSTART', type: 'no', state: start },
        { label: 'Q0.0\nSEAL', type: 'no', state: motorSealIn },
      ],
      interlock_nc: [
        { label: 'I0.1\nSTOP', type: 'nc', state: getInput('sw-stop') },
      ],
      coil: { label: 'Q0.0 MOTOR', state: motorRun }
    },
    {
      num: 2, desc: 'Safety Interlock (E-Stop / Overload)',
      contacts: [
        { label: 'I0.2\nE-STOP', type: 'nc', state: estop },
        { label: 'I0.3\nOVERLD', type: 'nc', state: overload },
      ],
      coil: { label: 'SAFETY OK', state: safetyOK }
    },
    {
      num: 3, desc: 'Alarm Trigger',
      contacts: [
        { label: 'I0.2\nE-STOP', type: 'no', state: estop },
        { label: 'I0.3\nFAULT', type: 'no', state: overload },
      ],
      coil: { label: 'Q0.1 ALARM', state: alarm }
    },
    {
      num: 4, desc: 'Freezer Compressor Interlock',
      contacts: [
        { label: 'I0.4\nFRZ OK', type: 'no', state: freezerOK },
        { label: 'SAFETY', type: 'no', state: safetyOK },
      ],
      coil: { label: 'Q0.2 COMP', state: compressor }
    },
    {
      num: 5, desc: 'Conveyor Sequential Start',
      contacts: [
        { label: 'I0.5\nCONV SEN', type: 'no', state: convSensor },
        { label: 'SAFETY', type: 'no', state: safetyOK },
      ],
      coil: { label: 'Q0.3 CONV', state: convMotor }
    },
  ];

  let html = '';
  rungs.forEach(rung => {
    const rungPowered = rung.contacts.every(c => c.type === 'no' ? c.state : !c.state) &&
                        (!rung.interlock_nc || rung.interlock_nc.every(c => !c.state));
    html += `<div style="margin-bottom:18px;">
      <div style="font-family:var(--font-mono);font-size:9px;color:var(--text-muted);margin-bottom:4px;letter-spacing:1px;">RUNG ${rung.num} ‚Äî ${rung.desc}</div>
      <div class="rung">
        <span class="rung-num">[${rung.num}]</span>
        <span class="rung-left-rail">|</span>`;

    rung.contacts.forEach(c => {
      const en = c.type === 'no' ? c.state : !c.state;
      html += `<span class="contact ${c.type === 'nc' ? 'nc' : ''} ${en ? 'energized' : ''}">[${c.type === 'nc' ? '/' : ' '}${c.label.split('\n')[0]}]</span>`;
    });

    if (rung.interlock_nc) {
      rung.interlock_nc.forEach(c => {
        const en = !c.state;
        html += `<span class="contact nc ${en ? 'energized' : ''}">[/${c.label.split('\n')[0]}]</span>`;
      });
    }

    html += `<div class="rung-wire ${rungPowered ? 'powered' : ''}"></div>
        <span class="coil ${rung.coil.state ? 'energized' : ''}">(${rung.coil.label})</span>
        <span class="rung-left-rail"> |</span>
      </div>
    </div>`;
  });

  container.innerHTML = html;
}

// Initialize
window.addEventListener('load', () => { updatePLC(); initLadderPage(); });
function initLadderPage() { updatePLC(); }

// ============================================================
// SCAN CYCLE
// ============================================================
let scanInterval = null;
let scanPhase = 0;
const scanPhases = ['scan-input','scan-logic','scan-output','scan-comm','scan-diag'];
const scanDurations = [1.2, 6.8, 0.8, 0.9, 0.3];

function startScanCycle() {
  if (scanInterval) return;
  let idx = 0;
  scanInterval = setInterval(() => {
    scanPhases.forEach((p, i) => {
      const el = document.getElementById(p);
      if (el) el.classList.toggle('active', i === idx);
    });
    const timeEl = document.getElementById('scan-time-val');
    const rateEl = document.getElementById('scan-rate');
    const total = (Math.random() * 2 + 9).toFixed(1);
    if (timeEl) timeEl.textContent = total;
    if (rateEl) rateEl.textContent = (1000 / parseFloat(total)).toFixed(0);
    idx = (idx + 1) % scanPhases.length;
  }, 400);
}

function stopScanCycle() {
  clearInterval(scanInterval);
  scanInterval = null;
  scanPhases.forEach(p => {
    const el = document.getElementById(p);
    if (el) el.classList.remove('active');
  });
  const timeEl = document.getElementById('scan-time-val');
  const rateEl = document.getElementById('scan-rate');
  if (timeEl) timeEl.textContent = '--';
  if (rateEl) rateEl.textContent = '--';
}

// ============================================================
// FAULT INJECTION
// ============================================================
function injectFault(type) {
  faultStates[type] = true;
  const btn = document.getElementById('fault-' + type);
  if (btn) btn.classList.add('active');

  const msgs = {
    sensor: '‚ö† FAULT: I0.5 Conveyor Sensor signal lost. Check cable and sensor head. Conveyor halted.',
    cpu: 'üî¥ CRITICAL: PLC CPU Watchdog Fault. All outputs de-energized. Power cycle required.',
    comm: '‚ö† FAULT: PROFINET Link Down. HMI communication lost. Running in local mode.',
    temp: '‚ö† ALARM: Freezer Temperature deviation detected. Temp above -18¬∞C setpoint. Compressor override.'
  };

  const bar = document.getElementById('fault-status-bar');
  if (bar) bar.innerHTML = `<span style="color:var(--accent-red)">‚óè</span> ${msgs[type]}`;

  const ts = new Date().toLocaleTimeString();
  faultLog.unshift(`[${ts}] ${msgs[type]}`);
  const logEl = document.getElementById('fault-log');
  if (logEl) logEl.innerHTML = faultLog.slice(0, 6).map(l =>
    `<span style="color:var(--accent-red)">‚óè</span> ${l}`
  ).join('<br>');

  updatePLC();
}

function clearAllFaults() {
  Object.keys(faultStates).forEach(k => faultStates[k] = false);
  document.querySelectorAll('.fault-btn').forEach(b => b.classList.remove('active'));
  const bar = document.getElementById('fault-status-bar');
  if (bar) bar.innerHTML = '<span style="color:var(--accent-green)">‚óè</span> All faults cleared. System nominal.';
  faultLog = [];
  const logEl = document.getElementById('fault-log');
  if (logEl) logEl.innerHTML = '<span style="color:var(--text-muted)">No faults recorded.</span>';
  updatePLC();
}

// ============================================================
// EXAM DATA
// ============================================================
const mcQuestions = [
  {
    q: "What is the typical PLC scan cycle time in a modern industrial controller?",
    opts: ["100‚Äì500 ms","1‚Äì20 ms","500‚Äì1000 ms","0.001‚Äì0.01 ms"],
    ans: 1,
    exp: "Typical PLC scan cycle times range from 1‚Äì20 ms. This enables fast response to process changes while maintaining deterministic control."
  },
  {
    q: "In ladder logic, a Normally Closed (NC) contact is represented as:",
    opts: ["[ ]","[/]","( )","‚Äî||‚Äî"],
    ans: 1,
    exp: "NC contacts are represented as [/] in ladder notation. They pass power when the associated coil is de-energized."
  },
  {
    q: "A TON timer in IEC 61131-3 stands for:",
    opts: ["Timer ON-delay","Timer OFF-delay","Total ON time","Timer Output Normal"],
    ans: 0,
    exp: "TON is a Timer ON-delay. The output Q becomes TRUE after the elapsed time reaches the preset value (PT) while IN remains TRUE."
  },
  {
    q: "In a PLC counter, the CTU instruction is used for:",
    opts: ["Count-Down operations","Count-Up operations","Cyclic timer","Communications update"],
    ans: 1,
    exp: "CTU is Count-Up. It increments the accumulated value (CV) each time a rising edge is detected on the CU input."
  },
  {
    q: "PID control stands for:",
    opts: ["Proportional, Integral, Derivative","Programmable, Industrial, Digital","Process, Input, Data","Pulse, Interval, Duration"],
    ans: 0,
    exp: "PID = Proportional, Integral, Derivative. The three terms work together to minimize error between setpoint and process variable."
  },
  {
    q: "In food manufacturing automation, what standard governs machinery safety requirements?",
    opts: ["IEC 61000","ISO 13849","IEC 60364","IEEE 802.3"],
    ans: 1,
    exp: "ISO 13849 defines safety-related parts of control systems, including Performance Levels (PL a‚Äìe) for food processing machinery."
  },
  {
    q: "PROFINET operates at which OSI layer for real-time communication?",
    opts: ["Application Layer (7)","Transport Layer (4)","Data Link Layer (2)","Physical Layer (1)"],
    ans: 2,
    exp: "PROFINET RT (Real-Time) communication operates primarily at the Data Link Layer (Layer 2) for deterministic, low-latency I/O data exchange."
  },
  {
    q: "What is OEE (Overall Equipment Effectiveness) calculated as?",
    opts: [
      "Availability √ó Performance √ó Quality",
      "Output √∑ Input √ó 100",
      "Uptime √∑ Total Time",
      "Production Rate √ó Shift Length"
    ],
    ans: 0,
    exp: "OEE = Availability √ó Performance √ó Quality. A world-class OEE is typically 85% or above for manufacturing operations."
  },
  {
    q: "In a motor start/stop circuit with seal-in, the auxiliary contact serves to:",
    opts: [
      "Protect against overload conditions",
      "Latch the motor contactor after start button is released",
      "Provide emergency stop function",
      "Monitor motor current"
    ],
    ans: 1,
    exp: "The auxiliary NO contact of the motor contactor is wired in parallel with the start button, creating a 'seal-in' or latch circuit that maintains power to the coil after the momentary start button is released."
  },
  {
    q: "Which of the following is NOT a valid IEC 61131-3 programming language?",
    opts: ["Ladder Diagram (LD)","Function Block Diagram (FBD)","C++ Object-Oriented","Sequential Function Chart (SFC)"],
    ans: 2,
    exp: "IEC 61131-3 defines 5 languages: LD, FBD, ST, IL, and SFC. C++ is not a standard PLC programming language under this standard."
  },
  {
    q: "In a freezer/refrigeration control system, when the temperature rises above setpoint, the correct PLC response is:",
    opts: [
      "Disable the compressor and trigger alarm",
      "Enable the compressor and close expansion valve",
      "Stop all conveyor motors",
      "Switch to manual control mode"
    ],
    ans: 1,
    exp: "When freezer temperature exceeds setpoint, the compressor should activate to provide additional cooling. An alarm may also be triggered if deviation is excessive."
  },
  {
    q: "What does a PLC watchdog timer do?",
    opts: [
      "Monitors real-time clock accuracy",
      "Monitors scan cycle and triggers fault if scan exceeds maximum time",
      "Counts production units per hour",
      "Monitors network packet timing"
    ],
    ans: 1,
    exp: "The watchdog timer monitors PLC scan cycle time. If the scan time exceeds the configured maximum (e.g., 150 ms), the watchdog triggers a CPU fault and de-energizes all outputs safely."
  },
  {
    q: "In Structured Text (ST), what is the correct syntax for an IF statement?",
    opts: [
      "IF condition THEN action END_IF;",
      "IF (condition) { action }",
      "WHEN condition DO action END",
      "CHECK condition: action; ENDCHECK"
    ],
    ans: 0,
    exp: "In IEC 61131-3 Structured Text: IF condition THEN statement(s); END_IF; ‚Äî Parentheses around the condition are optional."
  },
  {
    q: "A PROFINET device class that operates as a slave/field device is called:",
    opts: ["PROFINET Controller","PROFINET IO-Device","PROFINET Supervisor","PROFINET Gateway"],
    ans: 1,
    exp: "In PROFINET, the IO-Device is the field-level slave device (like sensors, drives, and I/O modules). The IO-Controller (PLC) reads/writes cyclic data to IO-Devices."
  },
  {
    q: "The function of an Interposing Relay in a PLC output circuit is to:",
    opts: [
      "Boost the PLC CPU clock speed",
      "Isolate PLC output from high-voltage loads and provide galvanic isolation",
      "Convert analog signals to digital",
      "Increase PLC scan speed"
    ],
    ans: 1,
    exp: "Interposing relays provide electrical isolation between the PLC's low-voltage output card and high-voltage field devices, protecting the PLC from voltage spikes and enabling voltage compatibility."
  },
  {
    q: "In ice cream production automation, HACCP stands for:",
    opts: [
      "High Automation Control and Critical Points",
      "Hazard Analysis and Critical Control Points",
      "Hydraulic Actuator Control and Check Process",
      "Human-Automated Control and Calibration Protocol"
    ],
    ans: 1,
    exp: "HACCP = Hazard Analysis and Critical Control Points. It is a food safety management system identifying potential hazards in the production process and establishing critical control points."
  },
  {
    q: "The derivative term (D) in a PID controller primarily:",
    opts: [
      "Reduces steady-state error",
      "Eliminates integral windup",
      "Responds to the rate of change of error to prevent overshoot",
      "Sets the process setpoint"
    ],
    ans: 2,
    exp: "The derivative term responds to the rate of change of the error. It provides damping to reduce overshoot and improve stability, particularly useful in temperature and pressure control loops."
  },
  {
    q: "In electrical troubleshooting, the FIRST step when a motor fails to start is:",
    opts: [
      "Replace the motor immediately",
      "Check control voltage at the coil and verify all interlock conditions",
      "Bypass the safety circuit",
      "Increase the overload relay setting"
    ],
    ans: 1,
    exp: "Systematic troubleshooting starts with verifying control voltage at the contactor coil and checking that all interlock conditions (E-stop, overload, interlocks) are satisfied before investigating further."
  },
  {
    q: "Which data type in IEC 61131-3 stores TRUE/FALSE values?",
    opts: ["INT","REAL","BOOL","WORD"],
    ans: 2,
    exp: "BOOL (Boolean) stores binary TRUE or FALSE values. It is the fundamental data type for digital inputs, outputs, and coil states in ladder logic."
  },
  {
    q: "In a conveyor sequencing application, a TOF timer would be used to:",
    opts: [
      "Start the conveyor after a set delay",
      "Keep the conveyor running for a set time after the stop signal",
      "Count products passing a sensor",
      "Monitor motor temperature"
    ],
    ans: 1,
    exp: "TOF (Timer OFF-delay) keeps the output Q TRUE for a set time after the input IN goes FALSE. Perfect for conveyor rundown, cooling fan delays, or lubrication systems."
  }
];

const scenarioQuestions = [
  {
    title: "Motor Will Not Start",
    desc: "An operator reports that a conveyor motor will not start when the start button is pressed. The HMI shows no active alarms. The motor has not been started since last weekend maintenance.",
    q: "What is your FIRST diagnostic action?",
    opts: [
      "Replace the motor starter contactor immediately",
      "Check that E-Stop buttons are reset, overload relay is not tripped, and verify 24VDC control voltage at the coil",
      "Increase the overload relay current setting by 20%",
      "Call the OEM for technical support"
    ],
    ans: 1,
    exp: "First, verify physical safety circuit reset (E-Stop pulled out, overload reset), then confirm control voltage. Most non-start faults are caused by safety interlocks or power supply issues, not the starter itself."
  },
  {
    title: "Freezer Temperature Rising",
    desc: "During production, the SCADA shows freezer cabinet temperature rising from -25¬∞C to -10¬∞C over 30 minutes. The compressor output bit Q0.2 shows TRUE in the PLC. Product quality is at risk.",
    q: "What is the most likely cause and appropriate action?",
    opts: [
      "The PLC scan cycle is too slow ‚Äî restart the PLC",
      "Compressor output bit is TRUE but verify the physical contactor is closed; check refrigerant pressure and condenser fan operation",
      "Increase the temperature PID setpoint",
      "The HMI display is faulty ‚Äî ignore and continue production"
    ],
    ans: 1,
    exp: "A TRUE output bit does not confirm the physical actuator is working. Check field-level hardware: contactor pull-in, condenser fan operation, refrigerant pressure. This is a common PLC troubleshooting trap ‚Äî always verify field hardware."
  },
  {
    title: "PROFINET Communication Fault",
    desc: "After replacing a frequency drive on the ice cream filler station, the PLC shows a PROFINET station fault for that device slot. All other devices on the network are communicating normally.",
    q: "What is the most appropriate troubleshooting step?",
    opts: [
      "Replace all PROFINET switches and cables in the panel",
      "Verify the new drive has been configured with the correct PROFINET Device Name and IP address matching the GSD device configuration in the project",
      "Increase the PROFINET update cycle time to 512ms",
      "Reset the entire PLC program and re-download"
    ],
    ans: 1,
    exp: "PROFINET devices must have matching Device Names (configured via DCP protocol) and correct IP addresses. A replacement device typically needs to be assigned its device name using STEP 7/TIA Portal before it can communicate."
  },
  {
    title: "Random Nuisance Trips",
    desc: "A packaging machine experiences random E-Stop trips 3‚Äì4 times per shift with no operator input. The E-Stop circuit uses a safety relay with 2-channel monitoring.",
    q: "What is the most likely root cause?",
    opts: [
      "The PLC program has a logic error in the E-Stop rung",
      "Loose connection or intermittent cable fault in the E-Stop loop causing momentary circuit interruption detected by the safety relay",
      "The safety relay sensitivity threshold is set too high",
      "The motor is drawing too much current, triggering the E-Stop"
    ],
    ans: 1,
    exp: "Random nuisance trips in a safety circuit almost always indicate an intermittent wiring fault (loose terminals, damaged cable, poor crimp). The safety relay correctly detects the momentary open circuit. Systematically check all E-Stop connections and cable routing."
  },
  {
    title: "Analog Signal Out of Range",
    desc: "A PT100 temperature sensor on the freezer returns -32768 (lowest possible value) on the HMI analog display. The actual freezer temperature is approximately -20¬∞C. The 4-20mA analog input module shows no LED errors.",
    q: "What is the most likely cause?",
    opts: [
      "The freezer is too cold for the sensor range",
      "Open circuit in the sensor wiring, causing the analog input to read the minimum value (wire break detection)",
      "The PLC program has a scaling error",
      "The analog input card needs replacing"
    ],
    ans: 1,
    exp: "A value of -32768 (minimum INT value) typically indicates a wire break fault. Most analog input modules detect open circuits and force the value to minimum/maximum. Check the PT100 sensor wiring for open connections, broken wires at the terminal block, or a failed sensor element."
  }
];

// ============================================================
// EXAM - MC
// ============================================================
let mcAnswers = {};
let mcSubmitted = false;
let mcScore = 0;
let mcTimerInterval = null;
let mcTimeLeft = 45 * 60;
let mcStartTime = null;
let mcTimeTaken = 0;

function renderMCQuestions() {
  const container = document.getElementById('mc-questions-container');
  if (!container) return;
  let html = '';
  mcQuestions.forEach((q, i) => {
    html += `<div class="question-block" id="q-block-${i}">
      <div class="question-num">Question ${i+1} of ${mcQuestions.length} &nbsp;¬∑&nbsp; Technical Assessment</div>
      <div class="question-text">${q.q}</div>
      ${q.opts.map((o, j) => `
        <label class="option-label" id="opt-${i}-${j}">
          <input type="radio" name="q${i}" value="${j}" onchange="recordMCAnswer(${i},${j})" ${mcSubmitted?'disabled':''}>
          <span class="opt-letter" style="color:var(--accent-orange);font-weight:700;font-family:var(--font-mono);flex-shrink:0;">${'ABCD'[j]}.</span>
          ${o}
        </label>`).join('')}
      <div class="answer-feedback" id="fb-${i}"></div>
    </div>`;
  });
  container.innerHTML = html;
}

function recordMCAnswer(qi, ai) {
  mcAnswers[qi] = ai;
}

function startExam() {
  showPage('exam-mc');
  resetMCExam();
}

function resetMCExam() {
  mcAnswers = {};
  mcSubmitted = false;
  mcScore = 0;
  mcTimeLeft = 45 * 60;
  mcStartTime = Date.now();
  clearInterval(mcTimerInterval);
  renderMCQuestions();
  const submitBtn = document.getElementById('submit-mc-btn');
  if (submitBtn) submitBtn.disabled = false;
  startMCTimer();
}

function startMCTimer() {
  updateMCTimerDisplay();
  mcTimerInterval = setInterval(() => {
    mcTimeLeft--;
    updateMCTimerDisplay();
    if (mcTimeLeft <= 0) { clearInterval(mcTimerInterval); submitMCExam(); }
  }, 1000);
}

function updateMCTimerDisplay() {
  const m = Math.floor(mcTimeLeft / 60);
  const s = mcTimeLeft % 60;
  const disp = document.getElementById('mc-timer-display');
  const bar = document.getElementById('mc-timer-bar');
  if (disp) disp.textContent = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  if (bar) {
    const pct = (mcTimeLeft / (45 * 60)) * 100;
    bar.style.width = pct + '%';
    bar.style.background = pct > 50 ? 'linear-gradient(90deg,var(--accent-green),var(--accent-orange))' :
                           pct > 20 ? 'linear-gradient(90deg,var(--accent-orange),var(--accent-orange2))' :
                           'linear-gradient(90deg,var(--accent-red),var(--accent-orange))';
  }
}

function submitMCExam() {
  if (mcSubmitted) return;
  mcSubmitted = true;
  mcTimeTaken = Math.round((Date.now() - (mcStartTime || Date.now())) / 1000);
  clearInterval(mcTimerInterval);

  const submitBtn = document.getElementById('submit-mc-btn');
  if (submitBtn) submitBtn.disabled = true;

  mcScore = 0;
  mcQuestions.forEach((q, i) => {
    const userAns = mcAnswers[i];
    const correct = userAns === q.ans;
    if (correct) mcScore++;

    const block = document.getElementById('q-block-' + i);
    const fb = document.getElementById('fb-' + i);

    if (block) block.classList.add(correct ? 'answered-correct' : 'answered-wrong');

    // Highlight options
    q.opts.forEach((_, j) => {
      const optEl = document.getElementById(`opt-${i}-${j}`);
      if (!optEl) return;
      if (j === q.ans) optEl.classList.add('correct-ans');
      else if (j === userAns && !correct) optEl.classList.add('wrong-ans');
      const inp = optEl.querySelector('input');
      if (inp) inp.disabled = true;
    });

    if (fb) {
      fb.className = 'answer-feedback show ' + (correct ? 'correct' : 'wrong');
      fb.innerHTML = (correct ? '‚úì Correct! ' : '‚úó Incorrect. ') + q.exp;
    }
  });

  sessionStorage.setItem('mc_score', mcScore);
  sessionStorage.setItem('mc_time', mcTimeTaken);
  updateResults();
}

function resetAllExams() {
  resetMCExam();
  resetScenarioExam();
  sessionStorage.removeItem('mc_score');
  sessionStorage.removeItem('scenario_score');
  document.getElementById('results-dashboard').classList.remove('visible');
  document.getElementById('results-placeholder').style.display = '';
}

// ============================================================
// SCENARIO EXAM
// ============================================================
let scenarioAnswers = {};
let scenarioSubmitted = false;
let scenarioScore = 0;

function renderScenarioQuestions() {
  const container = document.getElementById('scenario-questions-container');
  if (!container) return;
  let html = '';
  scenarioQuestions.forEach((s, i) => {
    html += `<div class="scenario-block" id="sc-block-${i}">
      <div style="font-family:var(--font-display);font-size:13px;color:var(--text-primary);margin-bottom:10px;">Case ${i+1}: ${s.title}</div>
      <div class="scenario-desc">${s.desc}</div>
      <div style="font-weight:700;font-size:14px;color:var(--accent-yellow);margin-bottom:10px;">${s.q}</div>
      ${s.opts.map((o, j) => `
        <label class="option-label" id="sc-opt-${i}-${j}">
          <input type="radio" name="sc${i}" value="${j}" onchange="recordScenarioAnswer(${i},${j})" ${scenarioSubmitted?'disabled':''}>
          <span style="color:var(--accent-yellow);font-weight:700;font-family:var(--font-mono);flex-shrink:0;">${'ABCD'[j]}.</span>
          ${o}
        </label>`).join('')}
      <div class="answer-feedback" id="sc-fb-${i}"></div>
    </div>`;
  });
  container.innerHTML = html;
}

function recordScenarioAnswer(qi, ai) { scenarioAnswers[qi] = ai; }

function resetScenarioExam() {
  scenarioAnswers = {};
  scenarioSubmitted = false;
  scenarioScore = 0;
  renderScenarioQuestions();
  const btn = document.getElementById('submit-scenario-btn');
  if (btn) btn.disabled = false;
}

function submitScenarioExam() {
  if (scenarioSubmitted) return;
  scenarioSubmitted = true;
  const btn = document.getElementById('submit-scenario-btn');
  if (btn) btn.disabled = true;

  scenarioScore = 0;
  scenarioQuestions.forEach((s, i) => {
    const userAns = scenarioAnswers[i];
    const correct = userAns === s.ans;
    if (correct) scenarioScore++;

    const fb = document.getElementById('sc-fb-' + i);
    s.opts.forEach((_, j) => {
      const optEl = document.getElementById(`sc-opt-${i}-${j}`);
      if (!optEl) return;
      if (j === s.ans) optEl.classList.add('correct-ans');
      else if (j === userAns && !correct) optEl.classList.add('wrong-ans');
      const inp = optEl.querySelector('input');
      if (inp) inp.disabled = true;
    });
    if (fb) {
      fb.className = 'answer-feedback show ' + (correct ? 'correct' : 'wrong');
      fb.innerHTML = (correct ? '‚úì Correct! ' : '‚úó Incorrect. Best answer: ') + s.exp;
    }
  });

  sessionStorage.setItem('scenario_score', scenarioScore);
  updateResults();
}

// ============================================================
// RESULTS & CHART
// ============================================================
function updateResults() {
  const storedMC = parseInt(sessionStorage.getItem('mc_score') || '0');
  const storedSC = parseInt(sessionStorage.getItem('scenario_score') || '0');
  const hasResults = sessionStorage.getItem('mc_score') !== null || sessionStorage.getItem('scenario_score') !== null;

  if (!hasResults) return;

  const mcPct = Math.round((storedMC / 20) * 100);
  const scPct = Math.round((storedSC / 5) * 100);
  const totalPct = Math.round((storedMC * 0.8 + storedSC * 0.2) / 20 * 100);

  const dashboard = document.getElementById('results-dashboard');
  const placeholder = document.getElementById('results-placeholder');
  if (dashboard) dashboard.classList.add('visible');
  if (placeholder) placeholder.style.display = 'none';

  const totalEl = document.getElementById('res-total');
  const techEl = document.getElementById('res-technical');
  const scEl = document.getElementById('res-scenario');
  if (totalEl) { totalEl.textContent = totalPct + '%'; totalEl.style.color = getScoreColor(totalPct); }
  if (techEl) { techEl.textContent = storedMC + '/20'; }
  if (scEl) { scEl.textContent = storedSC + '/5'; }

  // Grade banner
  let grade, gradeClass, gradeSub;
  if (totalPct >= 90) { grade = 'DEPLOYMENT READY'; gradeClass = 'deployment-ready'; gradeSub = 'Outstanding performance. Engineer is cleared for immediate overseas deployment.'; }
  else if (totalPct >= 75) { grade = 'TECHNICALLY COMPETENT'; gradeClass = 'competent'; gradeSub = 'Good technical knowledge. Minor review recommended before deployment.'; }
  else if (totalPct >= 60) { grade = 'NEEDS IMPROVEMENT'; gradeClass = 'needs-improvement'; gradeSub = 'Additional training required. Specific areas need reinforcement.'; }
  else { grade = 'NOT READY FOR DEPLOYMENT'; gradeClass = 'not-ready'; gradeSub = 'Significant gaps identified. Comprehensive retraining required.'; }

  const bannerEl = document.getElementById('grade-banner-container');
  if (bannerEl) {
    bannerEl.innerHTML = `<div class="grade-banner ${gradeClass}">
      <div class="grade-title" style="color:${getScoreColor(totalPct)}">${grade}</div>
      <div class="grade-sub">${gradeSub}</div>
    </div>`;
  }

  // Certificate
  const certScore = document.getElementById('cert-score');
  const certGrade = document.getElementById('cert-grade');
  const certDate = document.getElementById('cert-date');
  if (certScore) { certScore.textContent = totalPct + '%'; certScore.style.color = getScoreColor(totalPct); }
  if (certGrade) certGrade.textContent = grade;
  if (certDate) certDate.textContent = 'Assessment Date: ' + new Date().toLocaleDateString('en-GB', { day:'2-digit', month:'long', year:'numeric' });

  // Draw chart
  setTimeout(() => drawPerformanceChart(mcPct, scPct, totalPct), 100);
}

function getScoreColor(pct) {
  if (pct >= 90) return 'var(--accent-green)';
  if (pct >= 75) return 'var(--accent-blue)';
  if (pct >= 60) return 'var(--accent-yellow)';
  return 'var(--accent-red)';
}

function drawPerformanceChart(mcPct, scPct, totalPct) {
  const canvas = document.getElementById('perf-chart');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  const W = canvas.offsetWidth || 600;
  const H = 200;
  canvas.width = W;
  canvas.height = H;
  ctx.clearRect(0, 0, W, H);

  // Background
  ctx.fillStyle = 'rgba(0,0,0,0.2)';
  ctx.fillRect(0, 0, W, H);

  // Grid lines
  ctx.strokeStyle = 'rgba(0,170,255,0.08)';
  ctx.lineWidth = 1;
  [25,50,75,100].forEach(pct => {
    const y = H - (pct / 100) * (H - 30) - 20;
    ctx.beginPath(); ctx.moveTo(40, y); ctx.lineTo(W - 20, y); ctx.stroke();
    ctx.fillStyle = 'rgba(74,122,155,0.7)';
    ctx.font = '10px monospace';
    ctx.fillText(pct + '%', 2, y + 4);
  });

  const bars = [
    { label: 'Technical\nExam', val: mcPct, color: '#00aaff', x: W * 0.2 },
    { label: 'Scenario\nScore', val: scPct, color: '#00e5ff', x: W * 0.5 },
    { label: 'Total\nScore', val: totalPct, color: '#ff6b00', x: W * 0.8 }
  ];

  const barW = 60;
  bars.forEach(b => {
    const barH = ((b.val / 100) * (H - 50));
    const x = b.x - barW / 2;
    const y = H - barH - 30;

    // Bar gradient
    const grad = ctx.createLinearGradient(0, y, 0, H - 30);
    grad.addColorStop(0, b.color);
    grad.addColorStop(1, b.color + '44');
    ctx.fillStyle = grad;
    ctx.fillRect(x, y, barW, barH);

    // Value
    ctx.fillStyle = '#e8f4ff';
    ctx.font = 'bold 14px monospace';
    ctx.textAlign = 'center';
    ctx.fillText(b.val + '%', b.x, y - 8);

    // Label
    ctx.fillStyle = 'rgba(138,180,212,0.8)';
    ctx.font = '11px sans-serif';
    ctx.fillText(b.label.split('\n')[0], b.x, H - 14);
    ctx.fillText(b.label.split('\n')[1] || '', b.x, H - 2);
  });

  // Pass line
  const passY = H - (75 / 100) * (H - 50) - 30;
  ctx.strokeStyle = 'rgba(255,204,0,0.5)';
  ctx.setLineDash([6, 4]);
  ctx.lineWidth = 1.5;
  ctx.beginPath(); ctx.moveTo(40, passY); ctx.lineTo(W - 20, passY); ctx.stroke();
  ctx.setLineDash([]);
  ctx.fillStyle = 'rgba(255,204,0,0.8)';
  ctx.font = '10px monospace';
  ctx.textAlign = 'left';
  ctx.fillText('PASS LINE (75%)', 44, passY - 4);
}

// ============================================================
// WORKBOOK GENERATOR
// ============================================================
function generateAssessmentId() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let id = 'PL–°-';
  for (let i = 0; i < 8; i++) id += chars[Math.floor(Math.random() * chars.length)];
  return id;
}

function generateWorkbook() {
  const name = document.getElementById('wb-name').value.trim() || 'Not Provided';
  const dateVal = document.getElementById('wb-date').value;
  const dateStr = dateVal ? new Date(dateVal).toLocaleDateString('en-GB', {day:'2-digit',month:'long',year:'numeric'}) : new Date().toLocaleDateString('en-GB', {day:'2-digit',month:'long',year:'numeric'});
  const position = document.getElementById('wb-position').value.trim() || 'Automation Engineer';
  const location = document.getElementById('wb-location').value.trim() || 'Serbia ‚Äì Ice Cream Production Plant';
  const assessor = document.getElementById('wb-assessor').value.trim() || 'Not Specified';
  const assessmentId = generateAssessmentId();
  const includeAnswers = document.getElementById('wb-include-answers').checked;

  // Auto-fill score from session
  const storedMC = sessionStorage.getItem('mc_score');
  const storedSC = sessionStorage.getItem('scenario_score');
  let scoreStr = 'Pending Assessment';
  let mcNum = 0, scNum = 0, totalPct = 0;
  if (storedMC !== null) {
    mcNum = parseInt(storedMC);
    scNum = storedSC !== null ? parseInt(storedSC) : 0;
    totalPct = Math.round((mcNum * 0.8 + scNum * 0.2) / 20 * 100);
    scoreStr = totalPct + '%  (' + getGradeLabel(totalPct) + ')';
    document.getElementById('wb-score').value = scoreStr;
  }

  // Fill cover page
  document.getElementById('wb-print-name').textContent = name;
  document.getElementById('wb-print-position').textContent = position;
  document.getElementById('wb-print-location').textContent = location;
  document.getElementById('wb-print-assessor').textContent = assessor;
  document.getElementById('wb-print-date').textContent = dateStr;
  document.getElementById('wb-print-id').textContent = assessmentId;

  // Fill sig lines
  document.getElementById('wb-sig-name').textContent = name;
  document.getElementById('wb-sig-assessor').textContent = assessor;
  document.getElementById('wb-sig-id').textContent = assessmentId;

  // Fill score sheet
  if (storedMC !== null) {
    document.getElementById('wb-final-mc').innerHTML = '<strong>' + (mcNum * 4) + '</strong>';
    document.getElementById('wb-final-sc').innerHTML = '<strong>' + (scNum * 4) + '</strong>';
    document.getElementById('wb-final-total').innerHTML = '<strong>' + (mcNum * 4 + scNum * 4) + ' / 100 (auto)</strong>';
    document.getElementById('wb-final-pct').innerHTML = '<strong>' + totalPct + '%</strong>';

    // Highlight rating
    ['wb-rate-dr','wb-rate-tc','wb-rate-ni','wb-rate-nr'].forEach(id => {
      const el = document.getElementById(id);
      if (el) { el.classList.remove('selected'); el.querySelector('.wb-rating-check').textContent = '‚òê'; }
    });
    let rateId = totalPct >= 90 ? 'wb-rate-dr' : totalPct >= 75 ? 'wb-rate-tc' : totalPct >= 60 ? 'wb-rate-ni' : 'wb-rate-nr';
    const rateEl = document.getElementById(rateId);
    if (rateEl) { rateEl.classList.add('selected'); rateEl.querySelector('.wb-rating-check').textContent = '‚òë'; }
  }

  // Build MC questions
  const mcContainer = document.getElementById('wb-mc-questions');
  const mcAKGrid = document.getElementById('wb-mc-ak-grid');
  if (mcContainer) {
    let mcHtml = '';
    let akHtml = '';
    mcQuestions.forEach((q, i) => {
      mcHtml += `<div class="wb-mc-q">
        <div class="wb-mc-q-num">Question ${i + 1}</div>
        <div class="wb-mc-q-text">${q.q}</div>
        <div class="wb-mc-opts">
          ${q.opts.map((o, j) => `<div class="wb-mc-opt"><div class="wb-mc-bubble"></div><span class="wb-mc-opt-letter">${'ABCD'[j]}.</span> ${o}</div>`).join('')}
        </div>
      </div>`;
      akHtml += `<div class="wb-ak-item"><span class="wb-ak-qn">Q${i+1}</span><span class="wb-ak-ans">${'ABCD'[q.ans]}</span></div>`;
    });
    mcContainer.innerHTML = mcHtml;
    if (mcAKGrid) mcAKGrid.innerHTML = akHtml;
  }

  // Build scenario questions
  const scContainer = document.getElementById('wb-scenario-questions');
  const scAKGrid = document.getElementById('wb-scenario-ak-grid');
  if (scContainer) {
    let scHtml = '';
    let scAKHtml = '';
    scenarioQuestions.forEach((s, i) => {
      scHtml += `<div class="wb-scenario-q">
        <div class="wb-sc-label">Case ${i + 1} of 5</div>
        <div class="wb-sc-title">${s.title}</div>
        <div class="wb-sc-desc">${s.desc}</div>
        <div class="wb-sc-question">${s.q}</div>
        <div class="wb-sc-opts">
          ${s.opts.map((o, j) => `<div class="wb-sc-opt"><span class="wb-mc-opt-letter">${'ABCD'[j]}.</span> ${o}</div>`).join('')}
        </div>
        <div class="wb-justify-label">JUSTIFICATION / REASONING:</div>
        <div class="wb-line"></div><div class="wb-line"></div><div class="wb-line"></div>
        <div class="wb-score-row"><span>Marks Available: 4</span><span>Marks Awarded: ______</span></div>
      </div>`;
      scAKHtml += `<div class="wb-ak-item" style="grid-column:span 2;margin-bottom:8px;">
        <span class="wb-ak-qn">B-${i+1}</span>
        <span class="wb-ak-ans">${'ABCD'[s.ans]}</span>
        <span class="wb-ak-exp">&nbsp;‚Äî ${s.exp}</span>
      </div>`;
    });
    scContainer.innerHTML = scHtml;
    if (scAKGrid) scAKGrid.innerHTML = scAKHtml;
  }

  // Show/hide answer keys
  const allAKs = document.querySelectorAll('.wb-answer-key');
  allAKs.forEach(ak => {
    if (includeAnswers) ak.classList.add('visible');
    else ak.classList.remove('visible');
  });

  // Patch short-answer model answer keys
  const saKeys = ['wb-sa-d1-key','wb-sa-d2-key','wb-sa-d3-key','wb-sa-d4-key'];
  saKeys.forEach(id => {
    const el = document.getElementById(id);
    if (el) {
      el.classList.remove('wb-answer-key');
      el.style.display = includeAnswers ? 'block' : 'none';
    }
  });

  // Hide notice, show content
  document.getElementById('wb-preview-notice').style.display = 'none';
  document.getElementById('wb-content').style.display = 'block';
  document.getElementById('wb-content').scrollIntoView({ behavior: 'smooth' });
}

function getGradeLabel(pct) {
  if (pct >= 90) return 'DEPLOYMENT READY';
  if (pct >= 75) return 'TECHNICALLY COMPETENT';
  if (pct >= 60) return 'NEEDS IMPROVEMENT';
  return 'NOT READY';
}

function printWorkbook() {
  const name = document.getElementById('wb-name').value.trim();
  if (!name) {
    document.getElementById('wb-name').focus();
    document.getElementById('wb-name').style.borderColor = 'var(--accent-red)';
    setTimeout(() => document.getElementById('wb-name').style.borderColor = '', 2000);
    return;
  }
  generateWorkbook();
  setTimeout(() => window.print(), 300);
}

function showPDFInstructions() {
  const el = document.getElementById('pdf-instructions');
  if (el) el.style.display = el.style.display === 'none' ? 'block' : 'none';
}

// Pre-fill date on workbook page load
window.addEventListener('DOMContentLoaded', () => {
  const dateEl = document.getElementById('wb-date');
  if (dateEl) dateEl.value = new Date().toISOString().split('T')[0];
  // Auto-fill score field if available
  const storedMC = sessionStorage.getItem('mc_score');
  const storedSC = sessionStorage.getItem('scenario_score');
  if (storedMC !== null) {
    const mcNum = parseInt(storedMC);
    const scNum = storedSC !== null ? parseInt(storedSC) : 0;
    const totalPct = Math.round((mcNum * 0.8 + scNum * 0.2) / 20 * 100);
    const scoreEl = document.getElementById('wb-score');
    if (scoreEl) scoreEl.value = totalPct + '% ‚Äî ' + getGradeLabel(totalPct);
  }
});
</script>
</body>
</html>
